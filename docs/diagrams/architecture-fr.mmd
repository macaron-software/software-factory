graph TB
    subgraph CLIENT["Couche Client"]
        CLI["CLI (sf)"]
        WEB["Tableau de bord\nport 8080"]
        API_EXT["API REST\nport 8090"]
    end

    subgraph PLATFORM["Coeur Plateforme"]
        SERVER["Serveur FastAPI"]
        AUTH["Auth\nJWT + RBAC + OAuth"]
        ROUTES["Routes\n10 sous-modules"]

        subgraph AGENTS["Moteur Agents"]
            STORE["Catalogue Agents\n161 agents"]
            EXEC["Executeur\nLLM + Outils"]
            LOOP["Boucle Agent\nretry + timeout"]
        end

        subgraph WORKFLOWS["Moteur Workflows"]
            WF_STORE["Gestionnaire Workflows\nrun_workflow()"]
            WF_DEFS["39 Definitions\nbuiltins.py"]
            PATTERNS["12 Patterns\nsequentiel, parallele\nhierarchique, adversarial..."]
            PHASES["Executeur Phases\nretry, skip, checkpoint"]
        end

        subgraph MISSIONS["Couche Missions"]
            SAFE["Cycle SAFe\nPortfolio > Epic > Feature > Story"]
            BACKLOG["Product Backlog\nPriorisation WSJF"]
            SPRINTS["Execution Sprint\nCadence PI"]
        end

        subgraph A2A["Agent-a-Agent"]
            BUS["Bus de Messages"]
            NEGO["Negociation"]
            VETO["Protocole Veto"]
        end
    end

    subgraph SERVICES["Services"]
        LLM["Client LLM\nfallback multi-provider"]
        TOOLS["Outils\ncode, git, deploy\nmemoire, securite, navigateur"]
        MCP["Pont MCP\nfetch, memory, playwright"]
        NOTIF["Notifications\nSlack, Email, Webhook"]
        QUALITY["Moteur Qualite\n10 dimensions"]
    end

    subgraph OPS["Operations"]
        WATCHDOG["Watchdog\nauto-reprise, detection blocage"]
        HEAL["Auto-Reparation\nincident > triage > correctif"]
        OTEL["OpenTelemetry\ntracing + metriques"]
    end

    subgraph DATA["Couche Donnees"]
        DB[(SQLite\nplatform.db)]
        MEM["Memoire 4 couches\nsession, pattern\nprojet, global"]
        FTS["Recherche FTS5"]
    end

    subgraph PROVIDERS["Fournisseurs LLM"]
        MINIMAX["MiniMax M2.5"]
        AZURE_OAI["Azure OpenAI\nGPT-5-mini"]
        AZURE_AI["Azure AI Foundry"]
    end

    CLI --> SERVER
    WEB --> SERVER
    API_EXT --> SERVER
    SERVER --> AUTH
    AUTH --> ROUTES
    ROUTES --> AGENTS
    ROUTES --> WORKFLOWS
    ROUTES --> MISSIONS
    AGENTS --> A2A
    WF_STORE --> PATTERNS
    WF_STORE --> PHASES
    EXEC --> LLM
    EXEC --> TOOLS
    EXEC --> MCP
    LLM --> MINIMAX
    LLM --> AZURE_OAI
    LLM --> AZURE_AI
    QUALITY --> DB
    WATCHDOG --> WF_STORE
    OTEL -.-> SERVER
    STORE --> DB
    WF_STORE --> DB
    SAFE --> DB
    MEM --> FTS
    MEM --> DB
    NOTIF -.-> ROUTES

    classDef client fill:#e3f2fd,stroke:#1565c0,color:#000
    classDef core fill:#fff3e0,stroke:#e65100,color:#000
    classDef service fill:#e8f5e9,stroke:#2e7d32,color:#000
    classDef ops fill:#fce4ec,stroke:#c62828,color:#000
    classDef data fill:#f3e5f5,stroke:#6a1b9a,color:#000
    classDef provider fill:#e0f7fa,stroke:#00695c,color:#000

    class CLI,WEB,API_EXT client
    class SERVER,AUTH,ROUTES core
    class STORE,EXEC,LOOP core
    class WF_STORE,WF_DEFS,PATTERNS,PHASES core
    class SAFE,BACKLOG,SPRINTS core
    class BUS,NEGO,VETO core
    class LLM,TOOLS,MCP,NOTIF,QUALITY service
    class WATCHDOG,HEAL,OTEL ops
    class DB,MEM,FTS data
    class MINIMAX,AZURE_OAI,AZURE_AI provider
