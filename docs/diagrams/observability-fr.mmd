graph TB
    subgraph APP["Plateforme (FastAPI)"]
        MW["Middleware OTEL\nASGI"]
        SPANS["Traces\nrequete, agent\nworkflow, LLM"]
        METRICS["Metriques\nlatence, taux erreur\ndebit"]
    end

    subgraph WATCHDOG["Watchdog Continu"]
        HEALTH["Bilan de sante\ntoutes les 60s"]
        STALL["Detection blocage\nphases > 60min"]
        RESUME["Auto-reprise\n5/lot, toutes les 5min"]
        SESSION["Recuperation sessions\ninactives > 30min"]
        CLEANUP["Nettoyage\nsessions zombies"]
    end

    subgraph ANALYSIS["Analyse des Echecs"]
        CLASS["Classification erreurs\nsetup_failed, llm_provider\ntimeout, phase_error"]
        HEATMAP["Heatmap phases\ntaux echec par phase"]
        RECO["Recommandations\nsuggestions actionnables"]
    end

    subgraph QUALITY["Moteur Qualite"]
        DIM["10 Dimensions\ncomplexite, couverture\nsecurite, a11y..."]
        GATES["Portes Qualite\nPASS / FAIL / PENDING"]
        SCORE["Scores Projet\nradar chart"]
    end

    subgraph EXPORT["Couche Export"]
        OTLP["Exporteur\nOTLP/HTTP"]
        JAEGER["Jaeger\nport 16686"]
    end

    subgraph DASHBOARD["Tableau de bord /analytics"]
        TRACE_UI["Stats Tracing\ngraphique latence"]
        FAIL_UI["Analyse Echecs\ndoughnut erreurs\nbarres phases"]
        QUAL_UI["Radar Qualite\nbadge, scorecard"]
        RESUME_BTN["Bouton\nReprendre Tout"]
    end

    subgraph DB["Donnees"]
        SQLITE[(platform.db\nmissions, runs\nsessions)]
    end

    MW --> SPANS
    SPANS --> OTLP
    OTLP --> JAEGER
    MW --> METRICS

    HEALTH --> SQLITE
    STALL --> SQLITE
    RESUME --> APP
    SESSION --> SQLITE
    CLEANUP --> SQLITE

    CLASS --> SQLITE
    HEATMAP --> SQLITE
    RECO --> CLASS

    DIM --> SQLITE
    GATES --> DIM
    SCORE --> DIM

    TRACE_UI --> JAEGER
    FAIL_UI --> CLASS
    FAIL_UI --> HEATMAP
    QUAL_UI --> SCORE
    RESUME_BTN --> RESUME

    classDef app fill:#fff3e0,stroke:#e65100,color:#000
    classDef watch fill:#fce4ec,stroke:#c62828,color:#000
    classDef analysis fill:#e8f5e9,stroke:#2e7d32,color:#000
    classDef quality fill:#e3f2fd,stroke:#1565c0,color:#000
    classDef export fill:#f3e5f5,stroke:#6a1b9a,color:#000
    classDef dash fill:#e0f7fa,stroke:#00695c,color:#000
    classDef data fill:#eceff1,stroke:#37474f,color:#000

    class MW,SPANS,METRICS app
    class HEALTH,STALL,RESUME,SESSION,CLEANUP watch
    class CLASS,HEATMAP,RECO analysis
    class DIM,GATES,SCORE quality
    class OTLP,JAEGER export
    class TRACE_UI,FAIL_UI,QUAL_UI,RESUME_BTN dash
    class SQLITE data
