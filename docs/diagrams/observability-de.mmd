graph TB
    subgraph APP["Plattform (FastAPI)"]
        MW["OTEL ASGI\nMiddleware"]
        SPANS["Trace-Spans\nAnfrage, Agent\nworkflow, LLM"]
        METRICS["Metriken\nLatenz, Fehlerrate\nDurchsatz"]
    end

    subgraph WATCHDOG["Kontinuierlicher Watchdog"]
        HEALTH["Gesundheitscheck\nevery 60s"]
        STALL["Blockadeerkennung\nphases > 60min"]
        RESUME["Auto-Wiederaufnahme\n5/batch, every 5min"]
        SESSION["Sitzungswiederherstellung\ninaktiv > 30min"]
        CLEANUP["Bereinigung\nZombie-Sitzungen"]
    end

    subgraph ANALYSIS["Fehleranalyse"]
        CLASS["Fehlerklassifizierung\nsetup_failed, llm_provider\ntimeout, phase_error"]
        HEATMAP["Phasen-Heatmap\nFehlerrate pro Phase"]
        RECO["Empfehlungen\numsetzbare Vorschlage"]
    end

    subgraph QUALITY["Qualitats-Engine"]
        DIM["10 Dimensions\ncomplexity, coverage\nsecurity, a11y..."]
        GATES["Qualitastore\nPASS / FAIL / PENDING"]
        SCORE["Projektbewertungen\nradar chart"]
    end

    subgraph EXPORT["Export-Schicht"]
        OTLP["OTLP/HTTP\nExporter"]
        JAEGER["Jaeger\nport 16686"]
    end

    subgraph DASHBOARD["Dashboard /analytics"]
        TRACE_UI["Tracing-Statistiken\nLatenz-Diagramm"]
        FAIL_UI["Fehleranalyse\nFehler-Doughnut\nPhasen-Balken"]
        QUAL_UI["Qualitats-Radar\nbadge, scorecard"]
        RESUME_BTN["Alle Fortsetzen\nSchaltflache"]
    end

    subgraph DB["Daten"]
        SQLITE[(platform.db\nMissionen, Runs\nSitzungen)]
    end

    MW --> SPANS
    SPANS --> OTLP
    OTLP --> JAEGER
    MW --> METRICS

    HEALTH --> SQLITE
    STALL --> SQLITE
    RESUME --> APP
    SESSION --> SQLITE
    CLEANUP --> SQLITE

    CLASS --> SQLITE
    HEATMAP --> SQLITE
    RECO --> CLASS

    DIM --> SQLITE
    GATES --> DIM
    SCORE --> DIM

    TRACE_UI --> JAEGER
    FAIL_UI --> CLASS
    FAIL_UI --> HEATMAP
    QUAL_UI --> SCORE
    RESUME_BTN --> RESUME

    classDef app fill:#fff3e0,stroke:#e65100,color:#000
    classDef watch fill:#fce4ec,stroke:#c62828,color:#000
    classDef analysis fill:#e8f5e9,stroke:#2e7d32,color:#000
    classDef quality fill:#e3f2fd,stroke:#1565c0,color:#000
    classDef export fill:#f3e5f5,stroke:#6a1b9a,color:#000
    classDef dash fill:#e0f7fa,stroke:#00695c,color:#000
    classDef data fill:#eceff1,stroke:#37474f,color:#000

    class MW,SPANS,METRICS app
    class HEALTH,STALL,RESUME,SESSION,CLEANUP watch
    class CLASS,HEATMAP,RECO analysis
    class DIM,GATES,SCORE quality
    class OTLP,JAEGER export
    class TRACE_UI,FAIL_UI,QUAL_UI,RESUME_BTN dash
    class SQLITE data
