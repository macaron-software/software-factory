graph TB
    subgraph CLIENT["Client-Schicht"]
        CLI["CLI (sf)"]
        WEB["Web-Dashboard\nport 8080"]
        API_EXT["REST API\nport 8090"]
    end

    subgraph PLATFORM["Plattform-Kern"]
        SERVER["FastAPI-Server"]
        AUTH["Auth\nJWT + RBAC + OAuth"]
        ROUTES["Routes\n10 sub-modules"]

        subgraph AGENTS["Agenten-Engine"]
            STORE["Agenten-Katalog\n161 agents"]
            EXEC["Ausfuhrer\nLLM + Werkzeuge"]
            LOOP["Agenten-Schleife\nretry + timeout"]
        end

        subgraph WORKFLOWS["Workflow-Engine"]
            WF_STORE["Workflow-Speicher\nrun_workflow()"]
            WF_DEFS["39 Workflow-Defs\nbuiltins.py"]
            PATTERNS["12 Patterns\nsequential, parallel\nhierarchical, adversarial..."]
            PHASES["Phasen-Ausfuhrer\nretry, skip, checkpoint"]
        end

        subgraph MISSIONS["Missions-Schicht"]
            SAFE["SAFe-Lebenszyklus\nPortfolio > Epic > Feature > Story"]
            BACKLOG["Product Backlog\nWSJF-Priorisierung"]
            SPRINTS["Sprint-Ausfuhrung\nPI cadence"]
        end

        subgraph A2A["Agent-zu-Agent"]
            BUS["Nachrichtenbus"]
            NEGO["Verhandlung"]
            VETO["Veto Protocol"]
        end
    end

    subgraph SERVICES["Dienste"]
        LLM["LLM-Client\nMulti-Provider-Fallback"]
        TOOLS["Werkzeuge\nCode, Git, Deploy\nSpeicher, Sicherheit, Browser"]
        MCP["MCP Bridge\nfetch, memory, playwright"]
        NOTIF["Benachrichtigungen\nSlack, Email, Webhook"]
        QUALITY["Qualitats-Engine\n10 dimensions"]
    end

    subgraph OPS["Betrieb"]
        WATCHDOG["Watchdog\nAuto-Wiederaufnahme, Blockadeerkennung"]
        HEAL["Selbstheilung\nVorfall > Triage > Korrektur"]
        OTEL["OpenTelemetry\nTracing + Metriken"]
    end

    subgraph DATA["Datenschicht"]
        DB[(SQLite\nplatform.db)]
        MEM["Speicher 4 Schichten\nSitzung, Muster\nProjekt, Global"]
        FTS["FTS5-Suche"]
    end

    subgraph PROVIDERS["LLM-Anbieter"]
        MINIMAX["MiniMax M2.5"]
        AZURE_OAI["Azure OpenAI\nGPT-5-mini"]
        AZURE_AI["Azure AI Foundry"]
    end

    CLI --> SERVER
    WEB --> SERVER
    API_EXT --> SERVER
    SERVER --> AUTH
    AUTH --> ROUTES
    ROUTES --> AGENTS
    ROUTES --> WORKFLOWS
    ROUTES --> MISSIONS
    AGENTS --> A2A
    WF_STORE --> PATTERNS
    WF_STORE --> PHASES
    EXEC --> LLM
    EXEC --> TOOLS
    EXEC --> MCP
    LLM --> MINIMAX
    LLM --> AZURE_OAI
    LLM --> AZURE_AI
    QUALITY --> DB
    WATCHDOG --> WF_STORE
    OTEL -.-> SERVER
    STORE --> DB
    WF_STORE --> DB
    SAFE --> DB
    MEM --> FTS
    MEM --> DB
    NOTIF -.-> ROUTES

    classDef client fill:#e3f2fd,stroke:#1565c0,color:#000
    classDef core fill:#fff3e0,stroke:#e65100,color:#000
    classDef service fill:#e8f5e9,stroke:#2e7d32,color:#000
    classDef ops fill:#fce4ec,stroke:#c62828,color:#000
    classDef data fill:#f3e5f5,stroke:#6a1b9a,color:#000
    classDef provider fill:#e0f7fa,stroke:#00695c,color:#000

    class CLI,WEB,API_EXT client
    class SERVER,AUTH,ROUTES core
    class STORE,EXEC,LOOP core
    class WF_STORE,WF_DEFS,PATTERNS,PHASES core
    class SAFE,BACKLOG,SPRINTS core
    class BUS,NEGO,VETO core
    class LLM,TOOLS,MCP,NOTIF,QUALITY service
    class WATCHDOG,HEAL,OTEL ops
    class DB,MEM,FTS data
    class MINIMAX,AZURE_OAI,AZURE_AI provider
