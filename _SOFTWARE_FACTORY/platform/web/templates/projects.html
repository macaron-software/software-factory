{% extends "base.html" %}

{% block topbar_actions %}
{% include "partials/view_switcher.html" %}
<a href="/sessions/new" class="btn btn-primary">
    <svg class="icon icon-sm"><use href="#icon-plus"/></svg> New
</a>
{% endblock %}

{% block content %}
<div class="item-grid" data-view-grid data-view="card">
    {% for p in projects %}
    <a href="/projects/{{ p.info.id }}" class="item-card">
        <div class="item-icon">
            <span class="project-type-dot {{ p.info.factory_type }}"></span>
        </div>
        <div class="item-main">
            <div class="item-title">{{ p.info.name }}</div>
            <div class="item-subtitle">{{ p.info.factory_type | upper }}{% if p.info.domains %} · {{ p.info.domains[:2] | join(', ') }}{% endif %}</div>
            <div class="item-detail">
                {% if p.info.vision %}
                <p class="item-desc">{{ p.info.vision[:140] }}{% if p.info.vision|length > 140 %}…{% endif %}</p>
                {% elif p.info.description %}
                <p class="item-desc">{{ p.info.description[:140] }}{% if p.info.description|length > 140 %}…{% endif %}</p>
                {% endif %}
                {% if p.info.values %}
                <div class="item-tags">
                    {% for v in p.info.values[:3] %}
                    <span class="item-tag">{{ v }}</span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>
        <div class="item-meta">
            {% if p.info.has_git %}
            <span class="item-badge" hx-get="/api/projects/{{ p.info.id }}/git-status" hx-trigger="load" hx-swap="innerHTML">…</span>
            {% endif %}
            {% if p.info.lead_agent_id %}
            <span class="item-badge accent">{{ p.info.lead_agent_id }}</span>
            {% endif %}
        </div>
    </a>
    {% endfor %}
    {% if not projects %}
    <div class="empty-state">
        <p>No projects found.</p>
    </div>
    {% endif %}
</div>
{% endblock %}
