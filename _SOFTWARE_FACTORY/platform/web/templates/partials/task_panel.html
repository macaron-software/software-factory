<!-- Task panel partial â€” HTMX refreshable -->
<div class="panel-header">
    <h3><svg class="icon icon-sm"><use href="#icon-database"/></svg> Factory Tasks</h3>
    {% if tasks.total > 0 %}
    <span class="badge badge-blue">{{ tasks.total }} total</span>
    {% endif %}
</div>
<div class="panel-body">
    {% if tasks.total > 0 %}
    <!-- Summary counters -->
    <div class="task-summary-grid">
        {% if tasks.pending %}
        <div class="task-stat"><span class="task-stat-value pending">{{ tasks.pending }}</span><span class="task-stat-label">Pending</span></div>
        {% endif %}
        {% if tasks.tdd_in_progress %}
        <div class="task-stat"><span class="task-stat-value active">{{ tasks.tdd_in_progress }}</span><span class="task-stat-label">In Progress</span></div>
        {% endif %}
        {% if tasks.code_written %}
        <div class="task-stat"><span class="task-stat-value written">{{ tasks.code_written }}</span><span class="task-stat-label">Written</span></div>
        {% endif %}
        {% if tasks.build_ok %}
        <div class="task-stat"><span class="task-stat-value ok">{{ tasks.build_ok }}</span><span class="task-stat-label">Built</span></div>
        {% endif %}
        {% if tasks.deployed %}
        <div class="task-stat"><span class="task-stat-value deployed">{{ tasks.deployed }}</span><span class="task-stat-label">Deployed</span></div>
        {% endif %}
        {% if tasks.build_failed %}
        <div class="task-stat"><span class="task-stat-value failed">{{ tasks.build_failed }}</span><span class="task-stat-label">Failed</span></div>
        {% endif %}
        {% if tasks.tdd_failed %}
        <div class="task-stat"><span class="task-stat-value failed">{{ tasks.tdd_failed }}</span><span class="task-stat-label">TDD Failed</span></div>
        {% endif %}
    </div>

    <!-- Recent tasks list -->
    {% if recent_tasks %}
    <div class="task-list">
        {% for t in recent_tasks[:10] %}
        <div class="task-row">
            <span class="task-status-dot {{ t.status }}"></span>
            <span class="task-domain tag">{{ t.domain }}</span>
            <span class="task-title">{{ t.title[:55] }}{% if t.title|length > 55 %}...{% endif %}</span>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    {% else %}
    <p class="empty-state">No factory tasks found for this project.</p>
    {% endif %}
</div>
