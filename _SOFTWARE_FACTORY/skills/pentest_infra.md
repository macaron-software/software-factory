# Pentest Infrastructure â€” Network, Container & Cloud Security

## Checklist

### Container Security
- [ ] Running as root: Dockerfile missing USER directive
- [ ] Privileged containers: --privileged flag or securityContext.privileged
- [ ] Writable root filesystem: missing readOnlyRootFilesystem
- [ ] No resource limits: missing CPU/memory limits
- [ ] Latest tag: no version pinning
- [ ] Exposed Docker socket: /var/run/docker.sock mounted
- [ ] Container escape: kernel exploits, cgroups bypass

### Network Security
- [ ] Open ports: unnecessary services exposed
- [ ] Unencrypted traffic: HTTP instead of HTTPS
- [ ] Missing network policies: no segmentation between services
- [ ] DNS rebinding: internal services accessible via DNS tricks
- [ ] CORS misconfiguration: wildcard origins, credentials with wildcard

### Cloud Security (AWS/Azure/GCP)
- [ ] Public S3 buckets / Azure Blobs / GCS buckets
- [ ] Overly permissive IAM roles
- [ ] Metadata service access from containers (IMDS v1)
- [ ] Unencrypted storage volumes
- [ ] Missing MFA on admin accounts
- [ ] Public network interfaces on databases

### Secrets Management
- [ ] Hardcoded secrets in source code
- [ ] Secrets in environment variables (visible in /proc)
- [ ] Unrotated credentials (>90 days)
- [ ] Default passwords on services (databases, admin panels)
- [ ] .env files in deployment artifacts

### TLS/SSL
- [ ] Certificate validity and chain
- [ ] Weak cipher suites (RC4, DES, 3DES)
- [ ] TLS 1.0/1.1 still enabled
- [ ] Missing HSTS header
- [ ] Certificate pinning bypass

### Kubernetes Security
- [ ] RBAC: overly permissive ClusterRoles
- [ ] PodSecurityStandards: baseline vs restricted
- [ ] ServiceAccount tokens auto-mounted
- [ ] Secrets in etcd unencrypted
- [ ] NetworkPolicy: default deny + explicit allow

## Scan Methodology

### Port Scanning
```bash
# Quick scan
nmap -sV -sC target
# Full scan
nmap -p- -sV --script=vuln target
```

### Container Analysis
```bash
# Dockerfile lint
hadolint Dockerfile
# Image scan
trivy image myapp:latest
# Runtime analysis
docker inspect --format='{{.Config.User}}' container
```

### Dependency Audit
```bash
# Node.js
npm audit --json
# Python
pip-audit --format json
# Rust
cargo audit
```

## Anti-Patterns (REJECT)
- `docker run --privileged`
- `USER root` in production Dockerfile
- `0.0.0.0` bindings without firewall
- Secrets in docker-compose.yml
- `allowAll` network policies
- `cluster-admin` ClusterRoleBinding for app service accounts
