{
  "_meta": {
    "pattern": "accordion",
    "wcag_source": "https://www.w3.org/WAI/ARIA/apg/patterns/accordion/",
    "version": "1.2.0",
    "updated": "2026-01-08"
  },

  "applies_to": ["accordion", "accordion-group", "collapsible", "expandable"],

  "structure": {
    "container": {
      "element": "section",
      "class_pattern": "accordion-accordion",
      "role": "region"
    },
    "trigger": {
      "element": "div",
      "class_pattern": "accordion-accordion__title-wrapper",
      "figma_name": "Title wrapper",
      "attributes": {
        "role": "button",
        "tabindex": "0",
        "aria-expanded": "false"
      },
      "note": "Generator rule: name includes 'title wrapper' AND componentSlug includes 'accordion' → role=button + tabindex=0 + aria-expanded"
    },
    "panel": {
      "element": "div",
      "aria": {
        "role": "region",
        "aria-labelledby": { "type": "idref", "points_to": "trigger" }
      },
      "class_pattern": "accordion-accordion__content",
      "hidden_when": "collapsed"
    },
    "icon": {
      "element": "img",
      "class_pattern": "accordion-accordion__arrow-icon",
      "aria": { "aria-hidden": "true" },
      "rotation": { "collapsed": "0deg", "expanded": "180deg" },
      "transition": "transform 0.3s ease"
    },
    "optional_icon": {
      "figma_property": "Show icon",
      "type": "BOOLEAN",
      "default": false,
      "note": "Icon is hidden by default - set Show icon=true in Figma to display package/delivery icon"
    },
    "divider": {
      "element": "div",
      "class_pattern": "accordion-accordion__divider-top, accordion-accordion__divider-bottom",
      "css_note": "SVG from Figma has height=0, use background-color instead"
    }
  },

  "states": {
    "collapsed": {
      "trigger": { "aria-expanded": "false" },
      "panel": { "hidden": true, "max-height": "0" },
      "data_attr": "data-state=collapsed",
      "class": "accordion-accordion--collapsed"
    },
    "expanded": {
      "trigger": { "aria-expanded": "true" },
      "panel": { "hidden": false, "max-height": "2000px" },
      "data_attr": "data-state=expanded",
      "class": "accordion-accordion--expanded"
    },
    "hover": {
      "note": "Figma has State=Hover variant but CSS :hover pseudo-class handles this",
      "css": ".accordion-accordion__title-wrapper:hover { background: var(--color-neutral-bg); }"
    },
    "focus": {
      "note": "Figma has State=Focus variant with Focus state FRAME",
      "css": ".accordion-accordion__title-wrapper:focus-visible { outline: 2px solid var(--color-callout-border-info); outline-offset: -2px; }"
    },
    "disabled": {
      "trigger": { "aria-disabled": "true", "tabindex": "-1" },
      "data_attr": "data-state=disabled"
    }
  },

  "figma_issues": {
    "inline_styles_blocking": {
      "problem": "Generator outputs height:58px;max-height:58px inline which prevents expansion",
      "solution": "Use !important in CSS overrides to force height:auto"
    },
    "svg_height_zero": {
      "problem": "Divider SVG has viewBox='0 0 343 0' and height=0 - invisible",
      "solution": "Hide SVG with display:none, use parent div with background-color"
    },
    "focus_not_on_trigger": {
      "problem": "Previously, role=group was applied to title-wrapper instead of role=button",
      "solution": "Added rule: if name includes 'title wrapper' AND componentSlug includes 'accordion' → return role=button + tabindex=0"
    },
    "border_radius_type_mismatch": {
      "problem": "Generated CSS applies border-radius:8px via --collapsed/--expanded/data-state rules to ALL accordions. But Figma shows: Type=Default has cornerRadius=0, Type=Brand has cornerRadius=8",
      "solution": "In _accordion-overrides.css: .accordion-accordion:not(.accordion-accordion--brand) { border-radius: 0 !important; }",
      "fixed": "2026-01-08"
    }
  },

  "keyboard": {
    "Enter": { "action": "toggle", "on": "trigger" },
    "Space": { "action": "toggle", "on": "trigger" },
    "ArrowDown": { "action": "focus_next_trigger", "on": "trigger" },
    "ArrowUp": { "action": "focus_previous_trigger", "on": "trigger" },
    "Home": { "action": "focus_first_trigger", "on": "trigger" },
    "End": { "action": "focus_last_trigger", "on": "trigger" }
  },

  "focus_management": {
    "focusable_elements": ["trigger"],
    "tab_sequence": "one_per_accordion",
    "focus_visible": true
  },

  "animation": {
    "property": "max-height",
    "duration": "300ms",
    "easing": "ease-out",
    "respect_reduced_motion": true
  },

  "css_selectors": {
    "expanded": "[data-state='expanded'], [aria-expanded='true'], .accordion-accordion--expanded",
    "collapsed": "[data-state='collapsed'], [aria-expanded='false'], .accordion-accordion--collapsed",
    "disabled": "[aria-disabled='true'], [disabled]",
    "focus": ":focus-visible"
  },

  "css_overrides_required": {
    "container": {
      "height": "auto !important",
      "min-height": "0 !important",
      "max-height": "none !important",
      "overflow": "visible !important"
    },
    "title_wrapper": {
      "height": "auto !important",
      "min-height": "56px !important"
    },
    "divider": {
      "background": "var(--color-neutral-border)",
      "height": "1px !important"
    }
  }
}
