# Task T315: Add settings server actions

**Priority**: P1
**Queue**: TDD
**Type**: implementation

## File
veligo-platform/frontend/src/routes/(app)/settings/+page.server.ts

## Description
Add actions for updateProfile, changePassword, updateNotifications via gRPC

## Success Criteria
- [ ] Implementation complete
- [ ] cargo check passes (or npm run build for frontend)
- [ ] Unit/integration tests added
- [ ] No new warnings
- [ ] Works with gRPC calls (frontend) or database queries (backend)

## Ralph Status Block
---RALPH_STATUS---
STATUS: FAILED
COMPLEXITY: medium
WSJF: 10
---END_RALPH_STATUS---

## Last Failure (Wed Jan 14 10:04:27 CET 2026)
```
//   protoc-gen-ts_proto  v2.10.1
//   protoc               v6.33.2
// source: veligo.proto

/* eslint-disable */
import { BinaryReader, BinaryWriter } from "@bufbuild/protobuf/wire";

export const protobufPackage = "veligo.v1";

export interface LoginRequest {
  email: string;
  password: string;
  tenantSlug: string;
}

export interface LoginResponse {
  accessToken: string;
  refreshToken: string;
  user?: User | undefined;
}
```

## Last Failure (Wed Jan 14 10:04:54 CET 2026)
```
```

=== Action Results ===
bash: OK
/**
 * Admin Service - Unified API for Admin Dashboard
 *
 * SECURITY FIX (2025-01-01):
 * - ALL methods now REQUIRE tenantId parameter
 * - NO more empty string defaults that bypass tenant isolation
 * - Tenant ID should come from authStore (JWT claims)
 *
 * Uses gRPC-Web where available, with REST fallback
 * All methods are tenant-scoped via JWT
 *
 * gRPC Migration Status:
 * - Subscriptions: ✅ gRPC (subscriptionClient)
 * - Stations: ✅ gRPC (stationClient)
 * - Bikes: ✅ gRPC (bikeClient)
 
```

## Last Failure (Wed Jan 14 10:05:03 CET 2026)
```
import type { BinaryReadOptions } from "@protobuf-ts/runtime";
import type { IBinaryReader }
---
bash: OK
// Load real modules from filesystem
import { readdirSync, existsSync } from 'fs';
import { join } from 'path';
import type { PageServerLoad } from './$types';

export const load: PageServerLoad = async () => {
  const modulesDir = join(process.cwd(), '../../modules');
  
  const modules: any[] = [];
  
  try {
    const moduleDirs = readdirSync(modulesDir, { withFileTypes: true })
      .filter(dirent => dirent.isDirectory())
      .map(dirent => dirent.name);
    
    for (const dirName of mod
```

## Last Failure (Wed Jan 14 10:05:26 CET 2026)
```
cat veligo-platform/frontend/src/routes/\(app\)/settings/+page.svelte
```

=== Action Results ===
bash: OK
<script lang="ts">
import { page } from '$app/stores';
import { get } from 'svelte/store';
import { toast } from '$lib/stores';
import { fetchWithAuth } from '$lib/api';
import { validateSettings, type SettingsForm } from './validation';
import type { SettingsResponse } from './types';

export let data: SettingsResponse;

const tenantId = get(page).url.hostname.split('.')[0];
const apiUrl = `http://${tenantId}.veligo.test:8888/api`;

const loading = $state(false);
const error = $state<string | n
```

## Last Failure (Wed Jan 14 10:05:31 CET 2026)
```
```bash
sed -n '1,100p' veligo-platform/frontend/src/lib/grpc/client.ts
```

=== Action Results ===
bash: OK
/**
 * Base gRPC-Web client setup using @connectrpc/connect-web
 * 
 * PR-006: Frontend gRPC-Web Client Setup
 * This module provides the base transport and client configuration for gRPC-Web calls.
 */

import { createConnectTransport } from '@connectrpc/connect-web';
import type { Transport } from '@connectrpc/connect';

// gRPC-Web endpoint - routes to tonic-server via nginx proxy
const GRPC_BASE_URL = import.meta.env.VITE_GRPC_URL || 
  (typeof window !== 'undefined' 
    ? `${window.location
```

## Last Failure (Wed Jan 14 10:06:00 CET 2026)
```
<script lang="ts">
import { page } from '$app/stores';
import { get } from 'svelte/store';
import { toast } from '$lib/stores';
import { fetchWithAuth } from '$lib/api';
import { validateSettings, type SettingsForm } from './validation';
import type { SettingsResponse } from './types';

export let data: SettingsResponse;

const tenantId = get(page).url.hostname.split('.')[0];
const apiUrl = `http://${tenantId}.veligo.test:8

=== LLM Response ===
<think>
The output is truncated. Let me try a different approach to get the full file content.
</think>

```bash
cat veligo-platform/frontend/src/routes/\(app\)/settings/+page.svelte | tail -n +1</bash_command>
```

## Last Failure (Wed Jan 14 10:06:22 CET 2026)
```
</think>

```bash
wc -l veligo-platform/frontend/src/routes/\(app\)/settings/+page.svelte</bash_command>

=== LLM Response ===
<think>
The output was cut off. Let me try to get more information about the file structure and the grpc client.
</think>

```bash
ls -la veligo-platform/frontend/src/lib/grpc/</bash_command>

=== LLM Response ===
<think>
The bash command ran but I don't see output. Let me check the grpc client file to understand how gRPC calls are made.
</think>

```bash
cat veligo-platform/frontend/src/lib/grpc/client.ts</bash_command>
```

## Last Failure (Wed Jan 14 10:06:57 CET 2026)
```
</think>

```bash
wc -l veligo-platform/frontend/src/lib/grpc/client.ts && cat veligo-platform/frontend/src/lib/grpc/client.ts | tail -100</bash_command>

=== LLM Response ===
<think>
The bash commands are not returning the full output. Let me try to get smaller chunks of the file.
</think>

```bash
sed -n '1,50p' veligo-platform/frontend/src/lib/grpc/client.ts</bash_command>

=== LLM Response ===
<think>
The command is being cut off. Let me try a simpler approach to see the file content.
</think>

```bash
cat veligo-platform/frontend/src/lib/grpc/client.ts 2>/dev/null | head -80</bash_command>
```

## Last Failure (Wed Jan 14 10:07:33 CET 2026)
```
=== LLM Response ===
<think>
The output keeps getting cut off. Let me try a different approach - I'll look at the full file in smaller chunks to understand the structure.
</think>

```bash
sed -n '150,258p' veligo-platform/frontend/src/lib/grpc/client.ts
```

=== Action Results ===
bash: OK
      }
      if (msgLower.includes('not found') || msgLower.includes('404')) {
        return 'Aucune station trouvée. Veuillez réessayer.';
      }
      if (msgLower.includes('service unavailable') || msgLower.includes('503')) {
        return 'Service temporairement indisponible. Veuillez réessayer plus tard.';
      }
      if (msgLower.includes('timeout') || msgLower.includes('connection') || msgLower.includes('network')) {
        return 'Problème de connexion. Vérifiez votre connexion in
```
