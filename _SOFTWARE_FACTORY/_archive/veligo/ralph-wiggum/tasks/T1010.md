# Task T1010: Test dependency injection handling in PaymentAdapterFactory

**Priority**: P1
**WSJF Score**: 8.0
**Queue**: TDD
**Parent**: T871
**Generated by**: Fractal LLM Delegation

## Description
Test dependency injection handling in PaymentAdapterFactory

## Reason for Delegation
Task requires implementation of unit tests for PaymentAdapterFactory with missing dependencies and edge cases across 4+ files in backend/src/payment directory, touching multiple domains (payment logic, factory pattern, dependency injection, test isolation), exceeding 400 LOC and requiring test isolation, stubs, and edge case validation

## Success Criteria
- [ ] Task completed
- [ ] Tests pass
- [ ] No stubs or TODOs

## Ralph Status Block
---RALPH_STATUS---
STATUS: FAILED
COMPLEXITY: medium
PARENT_TASK: T871
---END_RALPH_STATUS---

## Last Failure (Wed Jan 14 18:11:18 CET 2026)
```
#[derive(Debug, Clone)]
pub struct PaymentRequest {
    pub amount: u64,
    pub currency: String,
    pub provider: PaymentProvider,
    pub reference_id: String,
    pub des

=== LLM Response ===
<think>
Let me get the full content of the factory.rs file which is the main file I need to test.
</think>

<bash>
cat -A veligo-platform/backend/src/infrastructure/adapters/payment/factory.rs</bash>

=== Action Results ===
bash: FAIL
cat: illegal option -- A
usage: cat [-belnstuv] [file ...]
```

## Last Failure (Wed Jan 14 18:11:48 CET 2026)
```
</read_file>

=== Action Results ===
bash: OK
    pub fn new(default_provider: PaymentProvider, mock_ui_base_url: String) -> Self {
        Self {
            default_provider,
            mock_ui_base_url,
        }
    }

    /// Get payment adapter for tenant
    ///
    /// Returns the appropriate payment adapter based on tenant configuration.
    /// Priority:
    /// 1. Stripe (if STRIPE_SECRET_KEY is set)
    /// 2. Paynum (if PAYNUM_API_KEY is set)
    /// 3. Mock (development/testing only)
    pub async fn get_adapter_for_tenant(
 
```

## Last Failure (Wed Jan 14 18:12:26 CET 2026)
```

```bash
cp veligo-platform/backend/src/infrastructure/adapters/payment/factory.rs /tmp/factory_full.rs && cat /tmp/factory_full.rs
```

=== Action Results ===
bash: OK
// Trace: Sprint 004 - 2025-12-11T12:46:10Z - Payment Adapter Factory
// Updated: 2025-12-27 - Production-ready: Stripe + Paynum adapters

#[allow(deprecated)]
use super::mock_adapter::MockPaymentAdapter;
use super::paynum::{PaynumAdapter, PaynumConfig};
use super::stripe_adapter::StripeAdapter;
use crate::domain::payment::{PaymentError, PaymentPort, PaymentProvider};
use std::sync::Arc;

/// Payment Adapter Factory
///
/// Selects the appropriate payment provider based on tenant configuration.
```
