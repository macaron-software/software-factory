# Task T164: Create FranceConnect SSO E2E journey test

**Priority**: P0
**Queue**: TDD
**AO Reference**: AO-IDFM-AUTH-3.1.3

## Description
Create FranceConnect SSO E2E journey test

## File
veligo-platform/tests/e2e/journeys/idfm-franceconnect-sso.spec.ts

## Success Criteria
- [ ] File created/modified correctly
- [ ] Code compiles
- [ ] Tests pass
- [ ] No regressions

## Ralph Status Block
---RALPH_STATUS---
STATUS: FAILED
COMPLEXITY: medium
WSJF: 8
---END_RALPH_STATUS---

## Last Failure (Tue Jan 13 19:32:29 CET 2026)
```

```bash
cat veligo-platform/frontend/tests/e2e/auth.spec.ts | sed -n '280,400p'
```

=== Action Results ===
bash: OK
test.describe('Authentication - SSO Buttons', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto(`${BASE_URL}/login`);
    await page.waitForLoadState('networkidle');
  });

  test('should display FranceConnect button', async ({ page }) => {
    const fcButton = page.locator('[data-testid="sso-franceconnect"]');
    const isVisible = await fcButton.isVisible().catch(() => false);

    if (isVisible) {
      await expect(fcButton).toHaveText(/FranceConnect/i);
      await expect(
```

## Last Failure (Tue Jan 13 19:33:02 CET 2026)
```
<bash>
sed -n '278,400p' veligo-platform/frontend/tests/e2e/auth.spec.ts</bash>

=== Action Results ===
bash: OK
});

test.describe('Authentication - SSO Buttons', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto(`${BASE_URL}/login`);
    await page.waitForLoadState('networkidle');
  });

  test('should display FranceConnect button', async ({ page }) => {
    const fcButton = page.locator('[data-testid="sso-franceconnect"]');
    const isVisible = await fcButton.isVisible().catch(() => false);

    if (isVisible) {
      await expect(fcButton).toHaveText(/FranceConnect/i);
      await ex
```

## Last Failure (Tue Jan 13 19:34:26 CET 2026)
```
<bash>
ls -la veligo-platform/tests/e2e/ 2>&1</bash>
<bash>
cat veligo-platform/tests/e2e/idfm-franceconnect-sso.spec.ts 2>&1 | head -20</bash>

=== Action Results ===
bash: OK
total 88
drwxr-xr-x  53 sylvain  staff  1696 Jan 13 16:11 .
drwxr-xr-x   5 sylvain  staff   160 Jan  4 16:03 ..
drwxr-xr-x   6 sylvain  staff   192 Dec 28 22:58 .auth
-rw-r--r--   1 sylvain  staff   445 Jan  3 13:28 .env.local
drwxr-xr-x@  3 sylvain  staff    96 Jan  8 08:32 admin
drwxr-xr-x   7 sylvain  staff   224 Jan  9 08:52 ao-compliance
drwxr-xr-x  15 sylvain  staff   480 Jan  7 09:37 api
drwxr-xr-x@  3 sylvain  staff    96 Jan  9 06:55 audit
drwxr-xr-x@  3 sylvain  staff    96 Jan  7 14:0
---
bash: OK
cat: veligo-platform/tests/e2e/idfm-franceconnect-sso.spec.ts: No such file or directory
```

## Last Failure (Wed Jan 14 08:33:32 CET 2026)
```
[0;32m[AGENT] Real Agent starting[0m
[0;34m[AGENT] Task: /Users/sylvain/_LAPOSTE/_VELIGO2/tools/ralph-wiggum/tasks/T164.md[0m
[0;34m[AGENT] Queue: tdd[0m
[0;34m[AGENT] Backend: local[0m
[0;32m[AGENT] Starting task: T164[0m
[0;34m[AGENT] Iteration 1/10[0m
[0;31m[AGENT] Local LLM failed: ('Connection aborted.', RemoteDisconnected('Remote end closed connection without response'))[0m

============================================================
RESULT: FAILED
============================================================
ERROR: LLM call failed
```

## Last Failure (Wed Jan 14 08:33:38 CET 2026)
```
[0;32m[AGENT] Real Agent starting[0m
[0;34m[AGENT] Task: /Users/sylvain/_LAPOSTE/_VELIGO2/tools/ralph-wiggum/tasks/T164.md[0m
[0;34m[AGENT] Queue: tdd[0m
[0;34m[AGENT] Backend: local[0m
[0;32m[AGENT] Starting task: T164[0m
[0;34m[AGENT] Iteration 1/10[0m
[0;31m[AGENT] Local LLM failed: HTTPConnectionPool(host='127.0.0.1', port=8002): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x106e3c590>: Failed to establish a new connection: [Errno 61] Connection refused'))[0m

============================================================
RESULT: FAILED
============================================================
ERROR: LLM call failed
```

## Last Failure (Wed Jan 14 08:33:45 CET 2026)
```
[0;32m[AGENT] Real Agent starting[0m
[0;34m[AGENT] Task: /Users/sylvain/_LAPOSTE/_VELIGO2/tools/ralph-wiggum/tasks/T164.md[0m
[0;34m[AGENT] Queue: tdd[0m
[0;34m[AGENT] Backend: local[0m
[0;32m[AGENT] Starting task: T164[0m
[0;34m[AGENT] Iteration 1/10[0m
[0;31m[AGENT] Local LLM failed: HTTPConnectionPool(host='127.0.0.1', port=8002): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x108cdc590>: Failed to establish a new connection: [Errno 61] Connection refused'))[0m

============================================================
RESULT: FAILED
============================================================
ERROR: LLM call failed
```
