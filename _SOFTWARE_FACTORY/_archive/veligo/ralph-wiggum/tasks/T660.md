# Task T660: Implement PaymentAdapterFactory with integration tests

**Priority**: P1
**WSJF Score**: 8.0
**Queue**: TDD
**Parent**: T625
**Generated by**: Fractal LLM Delegation

## Description
Implement PaymentAdapterFactory with integration tests

## Reason for Delegation
Task requires implementation of two payment adapters (Paynum + Stripe), factory pattern, and integration tests across multiple files, touching backend infrastructure and testing layers. This spans more than 5 files and involves HTTP clients, API integrations, and test mocking.

## Success Criteria
- [ ] Task completed
- [ ] Tests pass
- [ ] No stubs or TODOs

## Ralph Status Block
---RALPH_STATUS---
STATUS: FAILED
COMPLEXITY: medium
PARENT_TASK: T625
---END_RALPH_STATUS---

## Last Failure (Wed Jan 14 18:04:37 CET 2026)
```
<think>
Now I can see the veligo-platform directory. Let me explore more to understand the structure, especially looking for payment-related code.
</think>

```bash
ls -la /Users/sylvain/_LAPOSTE/_VELIGO2/veligo-platform/backend/src/ 2>/dev/null || ls -la /Users/sylvain/_LAPOSTE/_VELIGO2/veligo-platform/
```

=== Action Results ===
bash: OK
total 40
drwxr-xr-x  24 sylvain  staff    768 Jan 14 18:02 .
drwxr-xr-x  26 sylvain  staff    832 Jan 13 01:29 ..
drwxr-xr-x  40 sylvain  staff   1280 Jan 13 23:08 api
drwxr-xr-x   6 sylvain  staff    192 Dec 11 18:34 application
drwxr-xr-x@  4 sylvain  staff    128 Jan 13 19:33 auth
drwxr-xr-x   5 sylvain  staff    160 Jan 14 17:06 bin
drwxr-xr-x   5 sylvain  staff    160 Dec 28 02:29 chaos
drwxr-xr-x  20 sylvain  staff    640 Jan 14 17:50 domain
drwxr-xr-x   3 sylvain  staff     96 Dec 29 21:4
```

## Last Failure (Wed Jan 14 18:05:14 CET 2026)
```
drwxr-xr-x  5 sylvain  staff    160 Dec 12 10:51 ..
-rw-r--r--  1 sylvain  staff   5154 Dec 28 02:25 factory.rs
-rw-r--r--  1 sylvain  staff   9287 Dec 28 02:25 mock_adapter.rs
-rw-r--r--  1 sylvain  staff   2674 Jan 14 18:00 mod.rs
-rw-------  1 sylvain  staff  15876 Dec 28 01:55 paynum.rs
-rw-------  1 sylvain  staff  53452 Dec 31 11:30 stripe_adapter.rs
-rw-r--r--  1 sylvain  staff   9491 Jan 14 18:01 stripe_adapter_integration_test
---
bash: OK
//! # Payment Adapters Module
//!
//! Production-ready payment adapters for Veligo Platform.
//!
//! ## Available Adapters
//!
//! | Adapter | Use Case | Environment Variables |
//! |---------|----------|----------------------|
//! | [`StripeAdapter`] | Standard payment processing | `STRIPE_SECRET_KEY`, `STRIPE_WEBHOOK_SECRET` |
//! | [`PaynumAdapter`] | French public services (IDFM) | `PAYNUM_API_KEY`, `PAYNUM_WEBHOOK_SECRET`, `PAYNUM_MERCHANT_ID` |
//! | [`MockPaymentAdapter`] | Testing only |
```

## Last Failure (Wed Jan 14 18:05:44 CET 2026)
```
sed -n '1,200p' /Users/sylvain/_LAPOSTE/_VELIGO2/veligo-platform/backend/src/payment/adapter.rs</bash>

=== Action Results ===
bash: OK
//! Payment adapter trait and error types

use async_trait::async_trait;
use serde::{Deserialize, Serialize};
use thiserror::Error;

/// Errors that can occur during payment operations
#[derive(Debug, Error, Serialize, Deserialize)]
pub enum PaymentError {
    #[error("Payment processing failed: {message}")]
    Processing { message: String, code: Option<String> },
    
    #[error("Invalid request: {message}")]
    InvalidRequest { message: String },
    
    #[error("Network error: {source}")]
```
