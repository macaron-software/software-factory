# Task T500: Template incident reported

**Priority**: P2
**WSJF Score**: 6.2
**Queue**: TDD
**Category**: TEMPLATE
**Original ID**: TPL-EMAIL-007
**Phase**: üìß PHASE 5: TEMPLATES (Priority P2)
**Section**: 5.1 Email Templates

## Description
Template incident reported

## Test File
`templates/email-incident.spec.ts`

## Estimated Files
2 fichier(s) √† modifier

## Success Criteria
- [ ] Test E2E cr√©√©/modifi√©: `templates/email-incident.spec.ts`
- [ ] Test passe en local
- [ ] Pas de test.skip() sans condition
- [ ] Code review adversarial pass√©
- [ ] Pas de stubs ou TODOs

## Definition of Done (DoD)
- [ ] Feature compl√®tement impl√©ment√©e
- [ ] Tests E2E verts
- [ ] Conformit√© AO v√©rifi√©e (si applicable)
- [ ] Documentation mise √† jour

## Ralph Status Block
---RALPH_STATUS---
STATUS: FAILED
COMPLEXITY: low
WSJF: 6.2
CATEGORY: TEMPLATE
ORIGINAL_ID: TPL-EMAIL-007
---END_RALPH_STATUS---

## Last Failure (Wed Jan 14 14:27:00 CET 2026)
```

=== Action Results ===
bash: OK
admin.spec.ts
ao
auth.spec.ts
booking.spec.ts
catalog.spec.ts
first-booking.spec.ts
fixtures
global-setup.ts
helpers
login.spec.ts
modules.spec.ts
owner.spec.ts
registration.spec.ts
rgpd.spec.ts
signup.spec.ts
subscription.spec.ts
white-label
```

## Last Failure (Wed Jan 14 14:29:29 CET 2026)
```
total 184
drwxr-xr-x  15 sylvain  staff    480 Jan 13 16:10 .
drwxr-xr-x   5 sylvain  staff    160 Dec 17 10:35 ..
-rw-------   1 sylvain  staff     60 Dec 26 09:30 .env.production
drwxr-xr-x   8 sylvain  staff    256 Jan 12 22:01 .svelte-kit
drwxr-xr-x  92 sylvain  staff   2944 Jan 12 17:40 node_modules
-rw-r--r--   1 sylvain  staff  67415 Dec 26 09:30 package-lock.json
-rw-r--r--   1 sylvain  staff   1016 Dec 26 09:42 package.json
drwxr-xr-x   5 sylvain  staff    160 Jan 12 23:35 playwright-re

=== LLM Response ===
<think>
The project structure seems different. Let me look for tests directory and the email-incident files.
</think>

<bash>
find /Users/sylvain/_LAPOSTE/_VELIGO2 -name "*email-incident*" 2>/dev/null | head -10</bash>

=== Action Results ===
bash: OK
```

## Last Failure (Wed Jan 14 14:30:16 CET 2026)
```
drwxr-xr-x   10 sylvain  staff    320 Dec 25 23:57 payment
drwxr-xr-x    3 sylvain  staff     96 Dec 13 09:54 privacy
-rw-r--r--    1 sylvain  staff   5307 Jan 12 14:02 production-health.spec.ts
-rw-r--r--    1 sylvain  staff  51778 Dec 13 11:23 

=== LLM Response ===
<think>
Let me check if there's a templates directory in the tests/e2e folder and look at the existing test files to understand the test patterns used.
</think>

<bash>
find /Users/sylvain/_LAPOSTE/_VELIGO2/tests/e2e -type d -name "templates" 2>/dev/null</bash>
<bash>
ls -la /Users/sylvain/_LAPOSTE/_VELIGO2/tests/e2e/email/ 2>/dev/null || ls -la /Users/sylvain/_LAPOSTE/_VELIGO2/tests/e2e/ | grep -i email</bash>

=== Action Results ===
bash: OK

---
bash: FAIL
```

## Last Failure (Wed Jan 14 14:31:31 CET 2026)
```

  type Template = {
    id: string;
    name: string;
    preview: string;
    colors: {
      primary: string;
      secondary: string;
      accent?: string;
    };
    status: 'active' | 'available';
    category: string;
    description: string;
  };

  let templates: Template[] = [];
  let searchQuery = '';
  let selectedTempla
---
bash: FAIL
```

## Last Failure (Wed Jan 14 14:32:10 CET 2026)
```

=== Action Results ===
bash: FAIL

> veligo-platform@2.0.0 test
> playwright test templates/email-incident.spec.ts

Error: No tests found.
Make sure that arguments are regular expressions matching test files.
You may need to escape symbols like "$" or "*" and quote the arguments.


To open last HTML report run:
[36m[39m
[36m  npx playwright show-report[39m
[36m[39m

[1m[46m RUN [49m[22m [36mv4.0.17 [39m[90m/Users/sylvain/_LAPOSTE/_VELIGO2[39m

 [31m‚ùØ[39m templates/email-incident.spec.ts [2m([22m[2m17 tests[22
```

## Last Failure (Wed Jan 14 14:32:41 CET 2026)
```

const MOCK_USER_DATA = {
  email: 'test.user@veligo.app',
  firstName: 'Jean',
  lastName: 'Dupont',
  subscriptionId: 'SUB-2024-001'
};

// =====================================
// Test Suite: Email Incident Template
// =====================================

test.describe('[RED] Email Incident Template - Core Features', () => {

  test.beforeEach(async ({ page }) => {
   

=== Action Results ===
write: OK
File written
```

## Last Failure (Wed Jan 14 14:33:09 CET 2026)
```
import { describe, it, expect } from 'vitest';
import { incidentTemplate, type IncidentTemplateVariables } from './email-incident';

describe('email-incident', () => {
  describe('template structure', () => {
    it('should have a valid name', () => {
      expect(incidentTemplate.name).toBe('incident-reported');
    });

    it('should have a subject with incident placeholders', () => {

---
bash: OK
/Users/sylvain/_LAPOSTE/_VELIGO2/templates/email-incident.ts
/Users/sylvain/_LAPOSTE/_VELIGO2/templates/email-booking-confirm.ts
/Users/sylvain/_LAPOSTE/_VELIGO2/templates/email-booking-confirm.spec.ts
/Users/sylvain/_LAPOSTE/_VELIGO2/templates/email-incident.spec.ts
/Users/sylvain/_LAPOSTE/_VELIGO2/templates/email-welcome.ts
/Users/sylvain/_LAPOSTE/_VELIGO2/templates/email-verification.ts
/Users/sylvain/_LAPOSTE/_VELIGO2/templates/email-welcome.spec.ts
```

## Last Failure (Wed Jan 14 14:33:45 CET 2026)
```

=== Action Results ===
bash: OK
/**
 * Incident Email Template
 * Task: T500 - Template incident reported (TPL-EMAIL-007)
 */

import type { TemplateFile } from '@cp-station/customer-types';

export interface IncidentTemplateVariables {
  /** Name of the person reporting the incident */
  reporterName: string;
  /** Email of the person reporting the incident */
  reporterEmail: string;
  /** Unique identifier for the incident */
  incidentId: string;
  /** Title or summary of the incident */
  incidentTitle: string;
  /** Deta
```

## Last Failure (Wed Jan 14 14:34:34 CET 2026)
```
[31m+                       <tr>[39m
[31m+                     

=== LLM Response ===
<think>
Let me run the tests with verbose output to see the actual failures.
</think>

```bash
cd /Users/sylvain/_LAPOSTE/_VELIGO2 && npx vitest run templates/email-incident.spec.ts --reporter=verbose 2>&1
```

=== Action Results ===
bash: FAIL

[1m[46m RUN [49m[22m [36mv4.0.17 [39m[90m/Users/sylvain/_LAPOSTE/_VELIGO2[39m

 [32m‚úì[39m templates/email-incident.spec.ts[2m > [22memail-incident[2m > [22mtemplate structure[2m > [22mshould have a valid name[32m 1[2mms[22m[39m
 [32m‚úì[39m templates/email-incident.spec.ts[2m > [22memail-incident[2m > [22mtemplate structure[2m > [22mshould have a subject with incident placeholders[32m 0[2mms[22m[39m
 [32m‚úì[39m templates/email-incident.spec.ts[2m > [22memail-inc
```

## Last Failure (Wed Jan 14 14:35:57 CET 2026)
```
<bash>
cat /Users/sylvain/_LAPOSTE/_VELIGO2/tests/e2e/templates/email-incident.spec.ts | tail -50</bash>

=== Action Results ===
bash: OK
     233

---
bash: OK
    // Should not show affected users count or show 0
    await expect(page.locator('[data-testid="affected-users"]')).toContainText('0');
  });

  test('[RED] Missing resolution estimate - shows placeholder', async ({ page }) => {
    // Navigate without resolution data
    await page.goto(`${INCIDENT_EMAIL_BASE_URL}?hideEstimate=true`);
    
    // Should show appropriate message
    await expect(page.locator('[data-testid="resolution-estimate"]')).toContainText('En cours d\'√©valuation');
  })
```

## Last Failure (Wed Jan 14 14:36:38 CET 2026)
```
  reporterName: string;
  /** Email of the person reporting the incident */
  reporterEmail: string;
  /** Unique identifier for the incident */
  incidentId: string;
  /** Title or summary of the incident */
  incidentTitle: string;
  /** Deta
---
bash: OK
// ============================================================================
// E2E Tests: Email Incident Template - ALL Cases (Happy + Error)
// ============================================================================
// Status: üî¥ RED (TDD - Tests written first, implementation follows)
// Coverage: 100% email incident template scenarios
// Original ID: TPL-EMAIL-007
// Phase: 5.1 Email Templates
// ============================================================================

import { tes
```

## Last Failure (Wed Jan 14 14:37:21 CET 2026)
```
    it('should have a subject with incident placeholders', () => {


=== LLM Response ===
<think>
The output is being truncated. Let me run the tests first to see what's failing.
</think>

<bash>
cd /Users/sylvain/_LAPOSTE/_VELIGO2 && npx vitest run templates/email-incident.spec.ts --reporter=verbose 2>&1 | head -100
</bash>

=== Action Results ===
bash: OK

[1m[46m RUN [49m[22m [36mv4.0.17 [39m[90m/Users/sylvain/_LAPOSTE/_VELIGO2[39m

 [32m‚úì[39m templates/email-incident.spec.ts[2m > [22memail-incident[2m > [22mtemplate structure[2m > [22mshould have a valid name[32m 1[2mms[22m[39m
 [32m‚úì[39m templates/email-incident.spec.ts[2m > [22memail-incident[2m > [22mtemplate structure[2m > [22mshould have a subject with incident placeholders[32m 0[2mms[22m[39m
 [32m‚úì[39m templates/email-incident.spec.ts[2m > [22memail-inc
```
