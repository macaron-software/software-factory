# Task T603: Implémenter ModuleService complet

**Priority**: P0
**WSJF Score**: 9.0
**Queue**: TDD
**Domain**: api

## Description
Les endpoints du ModuleService retournent UNIMPLEMENTED.
Cela empêche la gestion des modules par tenant.

## Erreurs actuelles
```rust
// tonic-server.rs:688
Err(Status::unimplemented("get_module not yet implemented"))
// tonic-server.rs:704
Err(Status::unimplemented("toggle_module not yet implemented"))
```

## Fichier source
`veligo-platform/backend/src/bin/tonic-server.rs` lignes 688-704

## Solution
1. get_module → Requêter module par ID
2. toggle_module → Activer/désactiver module pour tenant

## Fichiers à modifier
- `veligo-platform/backend/src/bin/tonic-server.rs`
- Tables: `modules`, `tenant_modules`

## Test E2E
```typescript
test('owner can toggle module for tenant', async ({ page }) => {
  await loginAsOwner(page);
  await page.goto('/owner/tenants/idfm/modules');
  await page.click('[data-testid="toggle-payment-stripe"]');
  await expect(page.locator('[data-testid="module-enabled"]')).toBeVisible();
});
```

## Definition of Done
- [ ] get_module implémenté
- [ ] toggle_module implémenté
- [ ] Test E2E owner module management passe

## Ralph Status Block
---RALPH_STATUS---
STATUS: FAILED
COMPLEXITY: medium
WSJF: 9.0
---END_RALPH_STATUS---

## Last Failure (Wed Jan 14 14:33:58 CET 2026)
```
        _request: Request<ToggleModuleRequest>,
    ) -> Result<Response<ToggleModuleResponse>, Status> {
        Err(Status::unimplemented("toggle_module not yet implemented"))
    }
}

// Auth Service Implementation (gRPC)
#[derive(Debug, Clone)]
pub struct AuthServiceImpl {
    pool: Arc<PgPool>,
}

impl AuthServiceImpl {
    pub fn new(pool: Arc<PgPool>) -> Self {
        Self { pool }
    }
}

#[tonic::async_trait]
impl AuthService for AuthServiceI
```

## Last Failure (Wed Jan 14 14:34:41 CET 2026)
```
-rw-r--r--    1 sylvain  staff    1715 Dec 13 13:31 .cursorrules-fix
-rw-r--r--    1 sylvain  staff    4806 Dec 13 18:18 .cursorrules-module-integration
drwxr-xr-x    2 sylvain  staff      64 Dec 17 1

=== LLM Response ===
<think>
I can see the workspace is at /Users/sylvain/_LAPOSTE/_VELIGO2/. Let me find the backend directory.
</think>

```bash
find /Users/sylvain/_LAPOSTE/_VELIGO2 -type d -name "backend" 2>/dev/null | head -5
```

=== Action Results ===
bash: OK
/Users/sylvain/_LAPOSTE/_VELIGO2/tenant/backend
/Users/sylvain/_LAPOSTE/_VELIGO2/owner/backend
/Users/sylvain/_LAPOSTE/_VELIGO2/veligo-platform/owner/backend
/Users/sylvain/_LAPOSTE/_VELIGO2/veligo-platform/backend
/Users/sylvain/_LAPOSTE/_VELIGO2/veligo-platform/backend/backend
```

## Last Failure (Wed Jan 14 14:34:52 CET 2026)
```
</bash>

=== Action Results ===
bash: OK
    created_at: chrono::DateTime<chrono::Utc>,
    updated_at: chrono::DateTime<chrono::Utc>,
}

#[derive(Debug, Serialize, Deserialize)]
struct SubscriptionData {
    plan_id: String,
    price_cents: i32,
    currency: String,
    billing_period: String,
    #[serde(skip_serializing_if = "Option::is_none")]
    starts_at: Option<String>,
    #[serde(skip_serializing_if = "Option::is_none")]
    ends_at: Option<String>,
    #[serde(skip_serializing_if = "Option::is_none")]
    auto_renew: Optio
```

## Last Failure (Wed Jan 14 14:35:33 CET 2026)
```
            name: module.name,
            description: module.description,
            is_active: module.is_active,
        }))
    }

    async fn toggle_module(
        &self,
        request: Request<ToggleModuleRequest>,
    ) -> Result<Response<ToggleModuleResponse>, Status> {
        let req = request.into_inner();

        // Upsert the module activation for the tenant
        let result: (bool,) = sqlx::query_as!(
            (bool,),
            r#"
            INSERT INTO tenant_modules (tenant_id, module_id, is_enabled, updated_at)
            VALUES ($1, $2, $3, NOW())
            ON CONFLICT (tenant_id, module_id)
            DO UPDATE SET is_enab
```

## Last Failure (Wed Jan 14 14:36:25 CET 2026)
```
  string slug = 2;
  string name = 
---
bash: OK
             ORDER BY category, name",
        )
        .fetch_all(&*self.pool)
        .await
        .map_err(|e| {
            warn!("Database error listing modules: {}", e);
            Status::internal(format!("Failed to list modules: {}", e))
        })?;

        let modules: Vec<ProtoModule> = db_modules
            .iter()
            .map(|m| ProtoModule {
                id: m.id.to_string(),
                slug: m.name.clone(),
                name: m.display_name.clone(),
        
```

## Gates Failure (Wed Jan 14 14:38:13 CET 2026)
```
=== Gate Report: T603 ===
  ✗ Fail-on-Stubs: 71 stubs/TODOs found
      - veligo-platform/services/veligo-auth-service/src/handlers.rs:78: // TODO: Implement actual login with database lookup
      - veligo-platform/backend/src/bin/tonic-server.rs:1715: // TODO: Implement rate limiting via tonic interceptors instead of tower layers
      - veligo-platform/backend/src/infrastructure/http/module_routes.rs:265: // TODO: Add tests
  ✓ Security: No security issues detected
  FAILED
```
