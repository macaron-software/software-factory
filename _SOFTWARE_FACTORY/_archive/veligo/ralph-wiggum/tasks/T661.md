# Task T661: Create test suite for adapter factory behavior across both a

**Priority**: P1
**WSJF Score**: 8.0
**Queue**: TDD
**Parent**: T625
**Generated by**: Fractal LLM Delegation

## Description
Create test suite for adapter factory behavior across both adapters

## Reason for Delegation
Task requires implementation of two payment adapters (Paynum + Stripe), factory pattern, and integration tests across multiple files, touching backend infrastructure and testing layers. This spans more than 5 files and involves HTTP clients, API integrations, and test mocking.

## Success Criteria
- [ ] Task completed
- [ ] Tests pass
- [ ] No stubs or TODOs

## Ralph Status Block
---RALPH_STATUS---
STATUS: FAILED
COMPLEXITY: medium
PARENT_TASK: T625
---END_RALPH_STATUS---

## Last Failure (Wed Jan 14 18:04:52 CET 2026)
```

    /// Get payment adapter for tenant
    ///
    /// In MVP: Returns mock adapter
    /// In production: Query
---
bash: OK
        Self {
            payments: Arc::new(RwLock::new(HashMap::new())),
            mock_ui_base_url,
        }
    }

    /// Simulate payment completion (for testing)
    pub fn simulate_payment_success(&self, session_id: &str) -> Result<(), PaymentError> {
        let mut payments = self.payments.write().unwrap();
        if let Some(payment) = payments.get_mut(session_id) {
            payment.status = PaymentStatus::Succeeded;
            payment.updated_at = Utc::now();
            Ok(
```

## Last Failure (Wed Jan 14 18:05:30 CET 2026)
```
<bash>
cat veligo-platform/tenant/backend-api/src/infrastructure/adapters/payment/mod.rs</bash>

=== Action Results ===
bash: OK
// Trace: 2025-12-11T12:46:10 - Payment Adapters Module - Sprint 004

pub mod factory;
pub mod mock_adapter;

pub use factory::{PaymentAdapterFactory, TenantPaymentConfig};
pub use mock_adapter::MockPaymentAdapter;

use crate::domain::payment::PaymentPort;

/// Legacy function - use PaymentAdapterFactory instead
///
/// Returns the appropriate payment adapter based on tenant configuration
pub fn get_payment_adapter(_tenant_id: &str) -> Box<dyn PaymentPort> {
    // For backward compatibility, re
```

## Last Failure (Wed Jan 14 18:06:17 CET 2026)
```
bash: OK
// Trace: Sprint 004 - 2025-12-11T12:46:10Z - Mock Payment Adapter

use async_trait::async_trait;
use chrono::Utc;
use std::collections::HashMap;
use std::sync::{Arc, RwLock};
use uuid::Uuid;

use crate::domain::payment::{
    PaymentError, PaymentMethod, PaymentPort, PaymentStatus, RefundResult, WebhookEvent,
};

/// Mock Payment Adapter for testing/demo
///
/// Simulates a payment provider without external API calls.
/// Useful for:
/// - E2E tests
/// - Local development without API keys
/// 
```
