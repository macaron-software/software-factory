# Task T121: Retry failed task: Add missing data-testid: FranceConnectBut

**Priority**: P0
**Queue**: TDD
**AO_REF**: AO-IDFM-AUTH-3.1.3

## Description
Retry failed task: Add missing data-testid: FranceConnectButton.svelte

## File
veligo-platform/frontend/src/lib/hooks/examples/FranceConnectButton.svelte

## Success Criteria
- [ ] Issue resolved
- [ ] Tests pass
- [ ] No regressions

## Ralph Status Block
---RALPH_STATUS---
STATUS: FAILED
COMPLEXITY: medium
WSJF: 10
---END_RALPH_STATUS---

## Last Failure (Tue Jan 13 18:49:42 CET 2026)
```

  let { redirectUrl = '/auth/franceconnect/callback' }: Props = $props();

  function handleFranceConnect() {
    // Redirection vers le flow FranceConnect
    window.location.href = `/api/auth/franceconnect?redirect=$

=== LLM Response ===
<think>
The output is being truncated. Let me try a different approach to see the button element.
</think>

```bash
grep -n "button" veligo-platform/frontend/src/lib/hooks/examples/FranceConnectButton.svelte
```

=== Action Results ===
bash: OK
26:  <button type="button" class="franceconnect-btn" onclick={handleFranceConnect}>
37:  </button>
```

## Last Failure (Tue Jan 13 18:50:19 CET 2026)
```
bash: FAIL


=== LLM Response ===
<think>
Good - the file doesn't have data-testid, confirming the issue. Now I need to add it. Let me use the proper edit format.
</think>

```bash
sed -n '25,30p' veligo-platform/frontend/src/lib/hooks/examples/FranceConnectButton.svelte
```

=== Action Results ===
bash: OK

  <button type="button" class="franceconnect-btn" onclick={handleFranceConnect}>
    <img
      src="/images/franceconnect-logo.svg"
      alt=""
      class="franceconnect-logo"
```

## Last Failure (Tue Jan 13 18:50:53 CET 2026)
```
---
bash: OK
  <button type="button" class="franceconnect-btn" onclick={handleFranceConnect}>


=== LLM Response ===
<think>
The sed command failed due to an invalid command code. Let me try a different approach - maybe I need to escape something or use a different sed syntax.
</think>

<bash>cd veligo-platform/frontend/src/lib/hooks/examples && sed -i 's|<button type="button" class="franceconnect-btn" onclick={handleFranceConnect}>|<button type="button" class="franceconnect-btn" data-testid="FranceConnectButton" onclick={handleFranceConnect}>|' FranceConnectButton.svelte</bash>
<bash>sed -n '26p' veligo-platform/frontend/src/lib/hooks/examples/FranceConnectButton.svelte</bash>

=== Action Results ===
bash: FAIL
sed: 1: "FranceConnectButton.sve ...": invalid command code F

---
bash: OK
  <button type="button" class="franceconnect-btn" onclick={handleFranceConnect}>
```

## Last Failure (Wed Jan 14 08:33:32 CET 2026)
```
# Step 2: Use sed with proper escaping to insert data-testid
sed -i 's|<button type="button" class="franceconnect-btn" onclick={handleFranceConnect}>|<button type="button" class="franceconnect-btn" data-testid="FranceConnectButton" onclick={handleFranceConnect}>|' veligo-platform/frontend/src/lib/hooks/examples/FranceConnectButton.svelte
```

```bash
# Step 3: Verify the change was applied
grep "data-testid" veligo-platform/frontend/src/lib/hooks/examples/FranceConnectButton.svelte
```

```bash
# Step 4: Run frontend tests
cd veligo-platform/frontend && npm run test
```

```bash
# Final success check
SUCCESS
```

ERROR: LLM call failed
```

## Last Failure (Wed Jan 14 08:33:38 CET 2026)
```
[0;32m[AGENT] Real Agent starting[0m
[0;34m[AGENT] Task: /Users/sylvain/_LAPOSTE/_VELIGO2/tools/ralph-wiggum/tasks/T121.md[0m
[0;34m[AGENT] Queue: tdd[0m
[0;34m[AGENT] Backend: local[0m
[0;32m[AGENT] Starting task: T121[0m
[0;34m[AGENT] Iteration 1/10[0m
[0;31m[AGENT] Local LLM failed: HTTPConnectionPool(host='127.0.0.1', port=8002): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x10728c590>: Failed to establish a new connection: [Errno 61] Connection refused'))[0m

============================================================
RESULT: FAILED
============================================================
ERROR: LLM call failed
```

## Last Failure (Wed Jan 14 08:33:44 CET 2026)
```
[0;32m[AGENT] Real Agent starting[0m
[0;34m[AGENT] Task: /Users/sylvain/_LAPOSTE/_VELIGO2/tools/ralph-wiggum/tasks/T121.md[0m
[0;34m[AGENT] Queue: tdd[0m
[0;34m[AGENT] Backend: local[0m
[0;32m[AGENT] Starting task: T121[0m
[0;34m[AGENT] Iteration 1/10[0m
[0;31m[AGENT] Local LLM failed: HTTPConnectionPool(host='127.0.0.1', port=8002): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x108ea4590>: Failed to establish a new connection: [Errno 61] Connection refused'))[0m

============================================================
RESULT: FAILED
============================================================
ERROR: LLM call failed
```
