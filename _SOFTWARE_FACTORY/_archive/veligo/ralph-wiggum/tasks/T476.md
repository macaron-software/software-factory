# Task T476: Reporting mensuel IDFM

**Priority**: P2
**WSJF Score**: 6.8
**Queue**: TDD
**Category**: AO_COMPLIANCE
**Original ID**: AO-IDFM-004
**Phase**: ðŸŽ¯ PHASE 2: COMPLIANCE AO (Priority P1)
**Section**: 2.1 IDFM - FranceConnect

## Description
Reporting mensuel IDFM

## Test File
`ao/idfm-monthly-report.spec.ts`

## Estimated Files
4 fichier(s) Ã  modifier

## Success Criteria
- [ ] Test E2E crÃ©Ã©/modifiÃ©: `ao/idfm-monthly-report.spec.ts`
- [ ] Test passe en local
- [ ] Pas de test.skip() sans condition
- [ ] Code review adversarial passÃ©
- [ ] Pas de stubs ou TODOs

## Definition of Done (DoD)
- [ ] Feature complÃ¨tement implÃ©mentÃ©e
- [ ] Tests E2E verts
- [ ] ConformitÃ© AO vÃ©rifiÃ©e (si applicable)
- [ ] Documentation mise Ã  jour

## Ralph Status Block
---RALPH_STATUS---
STATUS: FAILED
COMPLEXITY: medium
WSJF: 6.8
CATEGORY: AO_COMPLIANCE
ORIGINAL_ID: AO-IDFM-004
---END_RALPH_STATUS---

## Last Failure (Wed Jan 14 14:13:40 CET 2026)
```
      expect(response.ok()).toBeTruthy();

      const report = await response.json();
      expect(report).toHaveProperty('total_revenue');
      expect(report).toHaveProperty('b
---
bash: OK
total 8
drwxr-xr-x   3 sylvain  staff    96 Jan  7 06:22 .
drwxr-xr-x  20 sylvain  staff   640 Jan  7 09:59 ..
-rw-r--r--   1 sylvain  staff  3970 Jan  7 06:22 full-admin.spec.ts

---
bash: OK
veligo-platform/frontend/tests/journeys/subscription.journey.spec.ts
veligo-platform/frontend/tests/e2e/owner.spec.ts
veligo-platform/frontend/tests/e2e/subscription.spec.ts
veligo-platform/frontend/tests/e2e/signup.spec.ts
veligo-platform/tests/e2e/user-journey/07-user-dashboard.spec.ts
veligo-platform/tests/e2e/journeys/subscription.journey.spec.ts
```

## Last Failure (Wed Jan 14 14:14:41 CET 2026)
```

```bash
wc -l ./tools/ralph-wiggum/tasks/tests/ao/idfm-franceconnect-v2.spec.ts && head -100 ./tools/ralph-wiggum/tasks/tests/ao/idfm-franceconnect-v2.spec.ts
```

=== Action Results ===
bash: OK
      57 ./tools/ralph-wiggum/tasks/tests/ao/idfm-franceconnect-v2.spec.ts
import { test, expect } from '@playwright/test';

test.describe('AO-IDFM-001: Authentification FranceConnect v2', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/login');
  });

  test('DEV-001: Bouton FranceConnect sur page login', async ({ page }) => {
    await expect(page.locator('[data-testid="franceconnect-btn"]')).toBeVisible();
  });

  test('DEV-002: Redirect vers FranceConnect', async ({ pa
```

## Last Failure (Wed Jan 14 14:15:45 CET 2026)
```
  description: string;
  category: string;
  icon: string;
  version: string;
  enabled: boolean;
  ao_idfm_ref: string;
  ao_nantes_ref: string;
}

export interface TogglePluginResponse {
  success: boolean;
  message: string;
}

const API_BASE_URL = import.meta.env.VITE_API_URL || 'https://api.veligo.app';

export class AdminAPI {
  private tenantId: string;

  constructor
```

## Last Failure (Wed Jan 14 14:16:33 CET 2026)
```

Let me check if there's any backend API related to admin or reporting, and also look at the AdminAPI class mentioned in the failure log.
</think>

```bash
find . -type f \( -name "*.ts" -o -name "*.js" \) -path "*admin*" 2>/dev/null | head -20
```

=== Action Results ===
bash: OK
./tenant/frontend-admin/src/lib/grpc/veligo.ts
./tenant/frontend-admin/src/lib/grpc/proto/veligo.ts
./tenant/frontend-admin/src/lib/components/icons/index.ts
./tenant/frontend-admin/src/lib/hooks/HookRegistry.ts
./tenant/frontend-admin/src/lib/api/payment.ts
./tenant/frontend-admin/src/lib/api/admin.ts
./tenant/frontend-admin/src/lib/api/plugins.ts
./tenant/frontend-admin/src/lib/i18n/index.ts
./tenant/frontend-admin/src/routes/(app)/marketplace/templates/+page.server.ts
./tenant/frontend-admin/
```

## Last Failure (Wed Jan 14 14:17:24 CET 2026)
```
</bash>

=== Action Results ===
bash: OK
import { defineConfig, devices } from '@playwright/test';

/**
 * Playwright E2E Configuration for Veligo Platform
 *
 * Environment Variables:
 * - BASE_URL: Frontend URL (default: http://localhost:8040)
 * - API_URL: Backend API URL (default: http://localhost:8041)
 * - TEST_TENANT: Tenant to test (idfm, nantes, lyon)
 */

const BASE_URL = process.env.BASE_URL || 'http://localhost:8040';
const API_URL = process.env.API_URL || 'http://localhost:8041';

export default defineConfig({
  testDir: '
```

## Last Failure (Wed Jan 14 14:20:44 CET 2026)
```

=== Action Results ===
bash: OK
      30 ./tools/ralph-wiggum/tasks/tests/ao/idfm-monthly-report.spec.ts

---
bash: OK
import { test, expect } from '@playwright/test';

test.describe('AO-IDFM-004: Reporting Mensuel IDFM', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/admin/reports/idfm');
  });

  test('DEV-001: AccÃ¨s Ã  la page de reporting mensuel IDFM', async ({ page }) => {
    await expect(page.locator('[data-testid="idfm-monthly-report-title"]')).toBeVisible();
  });

  test('DEV-002: Affichage du rÃ©sumÃ© des revenus', async ({ page }) => {
    await expect(page.locator('[data-testid=
```
