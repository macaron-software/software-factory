# TDD Task - Booking Cancellation Component

## Anomaly
Tests verify booking cancellation flow with selectors (`cancel-booking`, `cancel-modal`, `confirm-cancel`, `cancel-penalty`, `cancel-success`) that need implementation.

## Location
- Tests: `tests/journeys/booking.journey.spec.ts`
- Components: `src/lib/components/booking/*.svelte`

## Steps

### Phase 1: Create Booking Cancellation Component (RED)
```bash
# Create cancellation component
touch src/lib/components/booking/BookingCancellation.svelte
```

```svelte
<!-- src/lib/components/booking/BookingCancellation.svelte -->
<script lang="ts">
  let { booking, onCancel, penalty = 0 }: Props = $props();
  let showModal = $state(false);
  let reason = $state('');
</script>

<button data-testid="cancel-booking" class="btn-cancel" onclick={() => showModal = true}>
  Annuler la réservation
</button>

{#if showModal}
  <div data-testid="cancel-modal" class="modal-overlay">
    <div class="modal">
      <h3>Annuler la réservation</h3>

      <select data-testid="cancel-reason" bind:value={reason}>
        <option value="">Sélectionnez un motif</option>
        <option value="change_plans">Changement d'avis</option>
        <option value="not_available">Plus disponible</option>
        <option value="weather">Mauvais temps</option>
        <option value="other">Autre</option>
      </select>

      {#if penalty > 0}
        <div data-testid="cancel-penalty" class="penalty">
          Frais d'annulation: {penalty} €
        </div>
      {/if}

      <div class="actions">
        <button data-testid="dismiss-cancel" onclick={() => showModal = false}>
          Retour
        </button>
        <button
          data-testid="confirm-cancel"
          onclick={() => {
            onCancel?.(reason);
            showModal = false;
          }}
        >
          Confirmer l'annulation
        </button>
      </div>
    </div>
  </div>
{/if}

{#if booking.status === 'cancelled'}
  <div data-testid="cancel-success" class="cancellation-success">
    Réservation annulée avec succès
  </div>
{/if}
```

### Phase 2: Verify Tests Pass
```bash
cd veligo-platform/frontend && npm run test:journey -- --grep "cancel"
```

## Acceptance Criteria
- [ ] `data-testid="cancel-booking"` triggers cancellation flow
- [ ] `data-testid="cancel-modal"` shows cancellation dialog
- [ ] `data-testid="cancel-reason"` allows reason selection
- [ ] `data-testid="cancel-penalty"` shows penalty if applicable
- [ ] `data-testid="confirm-cancel"` confirms cancellation
- [ ] `data-testid="dismiss-cancel"` dismisses dialog
- [ ] `data-testid="cancel-success"` shows success message
- [ ] All cancellation tests pass
