# Task T104: Add missing data-testid: FranceConnectButton.svelte

**Priority**: P1
**Queue**: TDD
**AO_REF**: AO-IDFM-AUTH

## Description
FranceConnect component missing data-testid='franceconnect-login'

## File
veligo-platform/frontend/src/lib/hooks/examples/FranceConnectButton.svelte:0

## Success Criteria
- [ ] Issue fixed
- [ ] Code compiles
- [ ] Tests pass
- [ ] No regressions

## Ralph Status Block
---RALPH_STATUS---
STATUS: FAILED
COMPLEXITY: simple
WSJF: 8
---END_RALPH_STATUS---

## Last Failure (Tue Jan 13 18:36:54 CET 2026)
```

=== Action Results ===
bash: OK
<script lang="ts">
  /**
   * Bouton FranceConnect - Exemple d'injection via le syst√®me de hooks
   *
   * Ce composant est enregistr√© par le module auth-franceconnect
   * √† la position 'login-form' avec une priorit√© de 50
   */

  interface Props {
    redirectUrl?: string;
  }

  let { redirectUrl = '/auth/franceconnect/callback' }: Props = $props();

  function handleFranceConnect() {
    // Redirection vers le flow FranceConnect
    window.location.href = `/api/auth/franceconnect?redirect=$
```

## Last Failure (Tue Jan 13 18:37:32 CET 2026)
```

=== LLM Response ===
<think>
Now I have the full picture. The button element is on line 26:
```
<button type="button" class="franceconnect-btn" onclick={handleFranceConnect}>
```

I need to add `data-testid="franceconnect-login"` to this button element.

The new line should be:
```
<button type="button" class="franceconnect-btn" onclick={handleFranceConnect} data-testid="franceconnect-login">
```

Let me make this edit.
</think>

Now I have the full picture. The button is on line 26. I need to add `data-testid="franceconnect-login"` to it.
<edit file="veligo-platform/frontend/src/lib/hooks/examples/FranceConnectButton.svelte" old="<button type="button" class="franceconnect-btn" onclick={handleFranceConnect}>" new="<button type="button" class="franceconnect-btn" onclick={handleFranceConnect} data-testid="franceconnect-login">"/></edit>
```

## Last Failure (Tue Jan 13 18:38:10 CET 2026)
```
<edit file="veligo-platform/frontend/src/lib/hooks/examples/FranceConnectButton.svelte" old="<button type="button" class="franceconnect-btn" onclick={handleFranceConnect}>" new="<button type=&quot;button&quot; class=&quot;franceconnect-btn&quot; onclick={handleFranceConnect} data-testid=&quot;franceconnect-login&quot;>"/>
```

I notice that I'm escaping the quotes with &quot; but maybe that's causing issues. Let me try without the escaping - just use regular quotes inside the attribute values.
</think>

<edit file="veligo-platform/frontend/src/lib/hooks/examples/FranceConnectButton.svelte" old="<button type="button" class="franceconnect-btn" onclick={handleFranceConnect}>" new="<button type=&quot;button&quot; class=&quot;franceconnect-btn&quot; onclick={handleFranceConnect} data-testid=&quot;franceconnect-login&quot;>"/>
```

=== LLM Response ===
<think>
The system is asking me to provide actions using bash or <edit> tags. I've been trying to use <edit> tags but they seem to not be working. Let me try a bash command with sed to make the edit instead.
</think>

<bash>
sed -i 's/<button type="button" class="franceconnect-btn" onclick={handleFranceConnect}>/<button type="button" class="franceconnect-btn" onclick={handleFranceConnect} data-testid="franceconnect-login">/' veligo-platform/frontend/src/lib/hooks/examples/FranceConnectButton.svelte</bash>

=== Action Results ===
bash: FAIL
sed: 1: "veligo-platform/fronten ...": invalid command code v
```

## Last Failure (Wed Jan 14 08:33:25 CET 2026)
```
bash: OK
<script lang="ts">
  /**
   * Bouton FranceConnect - Exemple d'injection via le syst√®me de hooks
   *
   * Ce composant est enregistr√© par le module auth-franceconnect
   * √† la position 'login-form' avec une priorit√© de 50
   */

  interface Props {
    redirectUrl?: string;
  }

  let { redirectUrl = '/auth/franceconnect/callback' }: Props = $props();

  function handleFranceConnect() {
    // Redirection vers le flow FranceConnect
    window.location.href = `/api/auth/franceconnect?redirect=$

ERROR: LLM call failed
```

## Last Failure (Wed Jan 14 08:33:31 CET 2026)
```
[0;32m[AGENT] Real Agent starting[0m
[0;34m[AGENT] Task: /Users/sylvain/_LAPOSTE/_VELIGO2/tools/ralph-wiggum/tasks/T104.md[0m
[0;34m[AGENT] Queue: tdd[0m
[0;34m[AGENT] Backend: local[0m
[0;32m[AGENT] Starting task: T104[0m
[0;34m[AGENT] Iteration 1/10[0m
[0;31m[AGENT] Local LLM failed: ('Connection aborted.', ConnectionResetError(54, 'Connection reset by peer'))[0m

============================================================
RESULT: FAILED
============================================================
ERROR: LLM call failed
```

## Last Failure (Wed Jan 14 08:33:31 CET 2026)
```
[0;32m[AGENT] Real Agent starting[0m
[0;34m[AGENT] Task: /Users/sylvain/_LAPOSTE/_VELIGO2/tools/ralph-wiggum/tasks/T104.md[0m
[0;34m[AGENT] Queue: tdd[0m
[0;34m[AGENT] Backend: local[0m
[0;32m[AGENT] Starting task: T104[0m
[0;34m[AGENT] Iteration 1/10[0m
[0;31m[AGENT] Local LLM failed: ('Connection aborted.', ConnectionResetError(54, 'Connection reset by peer'))[0m

============================================================
RESULT: FAILED
============================================================
ERROR: LLM call failed
```

## Last Failure (Wed Jan 14 08:33:38 CET 2026)
```
[0;32m[AGENT] Real Agent starting[0m
[0;34m[AGENT] Task: /Users/sylvain/_LAPOSTE/_VELIGO2/tools/ralph-wiggum/tasks/T104.md[0m
[0;34m[AGENT] Queue: tdd[0m
[0;34m[AGENT] Backend: local[0m
[0;32m[AGENT] Starting task: T104[0m
[0;34m[AGENT] Iteration 1/10[0m
[0;31m[AGENT] Local LLM failed: HTTPConnectionPool(host='127.0.0.1', port=8002): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x10ab60590>: Failed to establish a new connection: [Errno 61] Connection refused'))[0m

============================================================
RESULT: FAILED
============================================================
ERROR: LLM call failed
```

## Last Failure (Wed Jan 14 08:33:38 CET 2026)
```
[0;32m[AGENT] Real Agent starting[0m
[0;34m[AGENT] Task: /Users/sylvain/_LAPOSTE/_VELIGO2/tools/ralph-wiggum/tasks/T104.md[0m
[0;34m[AGENT] Queue: tdd[0m
[0;34m[AGENT] Backend: local[0m
[0;32m[AGENT] Starting task: T104[0m
[0;34m[AGENT] Iteration 1/10[0m
[0;31m[AGENT] Local LLM failed: HTTPConnectionPool(host='127.0.0.1', port=8002): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x106ff0590>: Failed to establish a new connection: [Errno 61] Connection refused'))[0m

============================================================
RESULT: FAILED
============================================================
ERROR: LLM call failed
```

## Last Failure (Wed Jan 14 08:33:44 CET 2026)
```
[0;32m[AGENT] Real Agent starting[0m
[0;34m[AGENT] Task: /Users/sylvain/_LAPOSTE/_VELIGO2/tools/ralph-wiggum/tasks/T104.md[0m
[0;34m[AGENT] Queue: tdd[0m
[0;34m[AGENT] Backend: local[0m
[0;32m[AGENT] Starting task: T104[0m
[0;34m[AGENT] Iteration 1/10[0m
[0;31m[AGENT] Local LLM failed: HTTPConnectionPool(host='127.0.0.1', port=8002): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x108e0c590>: Failed to establish a new connection: [Errno 61] Connection refused'))[0m

============================================================
RESULT: FAILED
============================================================
ERROR: LLM call failed
```
