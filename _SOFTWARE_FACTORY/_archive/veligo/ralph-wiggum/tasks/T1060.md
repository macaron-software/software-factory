# Task T1060: Refactor existing test files to use proper mocking (e.g., mo

**Priority**: P1
**WSJF Score**: 8.0
**Queue**: TDD
**Parent**: T1028
**Generated by**: Fractal LLM Delegation

## Description
Refactor existing test files to use proper mocking (e.g., mockall or mockito) and remove stubs/TODOS

## Reason for Delegation
Task requires unit testing across 4+ files in backend/src/payment with dependency injection, factory pattern, and test isolation â€” involving StripeProcessor, PaymentAdapterFactory, and related test files. Total estimated LOC exceeds 400, touching multiple domains and requiring mock injection and test isolation.

## Success Criteria
- [ ] Task completed
- [ ] Tests pass
- [ ] No stubs or TODOs

## Ralph Status Block
---RALPH_STATUS---
STATUS: FAILED
COMPLEXITY: medium
PARENT_TASK: T1028
---END_RALPH_STATUS---

## Last Failure (Wed Jan 14 20:24:00 CET 2026)
```
<invoke><bash>
<command>ls /workspace/veligo-platform/backend/src/payment/</command>
 <timeout></timeout>
</bash></invoke>


=== Action Results ===
bash: FAIL
/bin/sh: -c: line 0: syntax error near unexpected token `<'
/bin/sh: -c: line 0: `
<command>ls /workspace/veligo-platform/backend/src/payment/</command>
 <timeout></timeout>
'


=== LLM Response ===
<think>
This is very strange - every bash command is failing. Let me try a different approach and look at what the project structure looks like.
</think>

Let me try a different approach:
<invoke><bash>
<command>ls -la</command>
 <timeout></timeout>
</bash></invoke>


=== Action Results ===
bash: FAIL
/bin/sh: -c: line 0: syntax error near unexpected token `<'
/bin/sh: -c: line 0: `
<command>ls -la</command>
 <timeout></timeout>
'
```

## Last Failure (Wed Jan 14 20:24:29 CET 2026)
```
-rw-r--r--    1 sylvain  staff    4806 Dec 13 18:18 .cursorrules-module-int

=== LLM Response ===
<think>
It seems like the project is in `/Users/sylvain/_LAPOSTE/_VELIGO2/`. Let me look for the backend folder there.
</think>

```bash
ls -la /Users/sylvain/_LAPOSTE/_VELIGO2/backend/
```

=== Action Results ===
bash: OK
total 8
drwxr-xr-x@   6 sylvain  staff   192 Jan 14 18:12 .
drwxr-xr-x  259 sylvain  staff  8288 Jan 14 20:24 ..
drwxr-xr-x   31 sylvain  staff   992 Dec 26 00:34 .sqlx
-rw-r--r--    1 sylvain  staff   288 Jan 14 18:12 Cargo.toml
drwxr-xr-x    4 sylvain  staff   128 Jan 14 18:12 src
drwxr-xr-x    3 sylvain  staff    96 Jan 14 18:09 tests
```

## Last Failure (Wed Jan 14 20:25:06 CET 2026)
```
## Plan

Based on my exploration, I see the payment module has:
- `adapter.rs` (78 lines) - defines `PaymentAdapter` trait, `PaymentTransaction`, `TransactionStatus`, `PaymentError`
- `factory.rs` (140 lines) - contains `PaymentAdapterFactory` struct
- `stripe_adapter.rs` - implements `PaymentAdapter` for Stripe
- `paypal_adapter.rs` - implements `PaymentAdapter` for PayPal

**Task**: Refactor existing tests to use proper mocking (mockall/mockito) and remove stubs/TODOs.

Let me check if there are test files and examine the test configuration:
<invoke><bash>
<command>find /Users/sylvain/_LAPOSTE/_VELIGO2/backend -type f -name "*.rs" -exec grep -l "#\[cfg(test)\]" {} \;</command>
 <timeout></timeout>
</bash></invoke>

=== Action Results ===
bash: FAIL
/bin/sh: -c: line 0: syntax error near unexpected token `newline'
/bin/sh: -c: line 0: `<command>find /Users/sylvain/_LAPOSTE/_VELIGO2/backend -type f -name "*.rs" -exec grep -l "#\[cfg(test)\]" {} \;</command>'
```
