# Task T1147: Add test isolation patterns with `#[fixture]` or `#[setup]`/

**Priority**: P1
**WSJF Score**: 8.0
**Queue**: TDD
**Parent**: T1047
**Generated by**: Fractal LLM Delegation

## Description
Add test isolation patterns with `#[fixture]` or `#[setup]`/`#[teardown]` where applicable

## Reason for Delegation
Task requires test isolation with proper setup/teardown across multiple files in backend/src/payment directory, involving dependency injection, factory pattern, and test interactions. Touches 4+ files (PaymentAdapterFactory, StripeProcessor, PaymentProcessor trait, and associated test files), exceeds 400 LOC, and involves multiple domains.

## Success Criteria
- [ ] Task completed
- [ ] Tests pass
- [ ] No stubs or TODOs

## Ralph Status Block
---RALPH_STATUS---
STATUS: FAILED
COMPLEXITY: medium
PARENT_TASK: T1047
---END_RALPH_STATUS---

## Last Failure (Wed Jan 14 20:28:42 CET 2026)
```
mod stripe_adapter_tests;
mod factory_tests;

=== LLM Response ===
<think>
Let me explore the test files to understand the current state and identify what test isolation patterns need to be added.
</think>

<bash>
cat veligo-platform/backend/src/infrastructure/adapters/payment/tests/mod.rs</bash>

=== Action Results ===
bash: OK
//! # Payment Adapters Integration Tests
//!
//! Integration tests for payment adapters and factory.

mod paynum_adapter_tests;
mod stripe_adapter_tests;
mod factory_tests;
```

## Last Failure (Wed Jan 14 20:35:15 CET 2026)
```
<bash>
cat veligo-platform/backend/src/infrastructure/adapters/payment/tests/mod.rs</bash>
<bash>
cat veligo-platform/backend/src/infrastructure/adapters/payment/stripe_adapter_integration_test</bash>

=== Action Results ===
bash: OK
//! # Payment Adapters Integration Tests
//!
//! Integration tests for payment adapters and factory.

mod paynum_adapter_tests;
mod stripe_adapter_tests;
mod factory_tests;
---
bash: FAIL
cat: veligo-platform/backend/src/infrastructure/adapters/payment/stripe_adapter_integration_test: No such file or directory


ERROR: LLM call failed
```

## Last Failure (Wed Jan 14 20:36:07 CET 2026)
```
mod tests {
    use super::*;

    #[test]
    fn test_parse_currency() {
        assert!(matches!(
            StripeAdapter::parse_currency("eur"),
            Currency::EUR
        ));
        assert!(matches!(
            StripeAdapter::parse_currency("EUR"),
            Currency::EUR
        ));
        assert!(matches!(
            StripeAdapter::parse_currency("usd"),
            Currency::USD
        ));
        assert!(matches!(
            StripeAdapter::parse_currency("gbp"),
        
```
