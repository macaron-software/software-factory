# Task T487: Subvention Nantes MÃ©tropole

**Priority**: P2
**WSJF Score**: 6.5
**Queue**: TDD
**Category**: AO_COMPLIANCE
**Original ID**: AO-NANTES-004
**Phase**: ðŸŽ¯ PHASE 2: COMPLIANCE AO (Priority P1)
**Section**: 2.2 Nantes - PayNum

## Description
Subvention Nantes MÃ©tropole

## Test File
`ao/nantes-subsidy.spec.ts`

## Estimated Files
3 fichier(s) Ã  modifier

## Success Criteria
- [ ] Test E2E crÃ©Ã©/modifiÃ©: `ao/nantes-subsidy.spec.ts`
- [ ] Test passe en local
- [ ] Pas de test.skip() sans condition
- [ ] Code review adversarial passÃ©
- [ ] Pas de stubs ou TODOs

## Definition of Done (DoD)
- [ ] Feature complÃ¨tement implÃ©mentÃ©e
- [ ] Tests E2E verts
- [ ] ConformitÃ© AO vÃ©rifiÃ©e (si applicable)
- [ ] Documentation mise Ã  jour

## Ralph Status Block
---RALPH_STATUS---
STATUS: FAILED
COMPLEXITY: medium
WSJF: 6.5
CATEGORY: AO_COMPLIANCE
ORIGINAL_ID: AO-NANTES-004
---END_RALPH_STATUS---

## Last Failure (Wed Jan 14 14:18:52 CET 2026)
```
find ./veligo-platform -path "*tests*" -name "*.spec.ts" | xargs grep -l "subsidy\|subsidies" 2>/dev/null</bash>

=== Action Results ===
bash: OK

---
bash: OK
./veligo-platform/frontend/src/app.d.ts:type TenantId = 'idfm' | 'nantes' | 'lyon' | 'default';
./veligo-platform/frontend/src/app.d.ts:      /** Current subdomain (owner, admin, idfm, nantes, lyon, etc.) */
./veligo-platform/frontend/src/hooks.client.ts:  nantes: {
./veligo-platform/frontend/src/hooks.client.ts:  nantes: {
./veligo-platform/frontend/src/lib/grpc/bike.ts:  const validTenants = ['idfm', 'nantes', 'toulouse', 'lille', 'lyon'];
./veligo-platform/frontend/src/lib/config/tenantAssets
---
bash: OK
./veligo-platform/frontend/tests/api/subscriptions.api.spec.ts
./veligo-platform/frontend/tests/journeys/subscription.journey.spec.ts
./veligo-platform/frontend/tests/journeys/01-registration.spec.ts
./veligo-platform/tests/e2e/journeys/subscription.journey.spec.ts
./veligo-platform/tests/e2e/journeys/01-registration.spec.ts
```

## Last Failure (Wed Jan 14 14:19:24 CET 2026)
```
AO-E2E-VISUAL-SUMMARY.txt
APPLICATION-COMPLETE.txt
ARCHITECTURE-DEV-CORRECT.md
AZURE-DEPLOY-SUMMARY.txt
AZURE-DEPLOYMENT-SUMMARY.txt
BACKLOG-VALUE-DRIVEN.md
BUILD-MANIFEST.md
CHAOS-ENGINEERING-NETFLIX-ARCHITECTURE.md.backup
CHAOS-ENGINEERING-SUMMARY.txt
CI-CD-README.md
CLAUDE.md
CLI-COMPLETE-REFERENCE.md
CLI-QUICK-START.md
COMMENT-LANCER.txt
COMPLETE-AUTH-CONTEXT-IMPLEMENTATION.tsx
CURSOR-SWARM-README.txt
CURSOR-WORKFLOW-VISUAL.txt
Cargo.lock
Cargo.toml
DASHBOARD-CHECK-F
```

## Last Failure (Wed Jan 14 14:20:19 CET 2026)
```
```

=== Action Results ===
bash: OK
/**
    const subResponse = await request.post('/api/subscriptions', {
      headers: authHeader(token),
      data: { plan_id: 'basic' },
    });
    const subData = await subResponse.json();
    subscriptionId = subData.id;
  });

  test.afterAll(async () => {
    await request.dispose();
  });

  test('SUB.16 - POST /api/subscriptions/:id/upgrade - Upgrades to higher plan', async () => {
    const response = await request.post(`/api/subscriptions/${subscriptionId}/upgrade`, {
      headers: a
```
