# Task T136: Create E2E Journey - subscriber-onboarding

**Priority**: P1
**Queue**: TDD
**AO_REF**: AO-IDFM-JOURNEY
**Tenant**: idfm

## Description
Missing E2E journey: subscriber-onboarding - New user registers, selects plan, pays, gets bike

Journey: New user registers, selects plan, pays, gets bike

## File to Create
tests/e2e/journeys/idfm-subscriber-onboarding.spec.ts

## Test Template
```typescript
import { test, expect } from '@playwright/test';
import { users } from '../fixtures/users.json';
import { stations } from '../fixtures/stations.json';

const BASE_URL = process.env.IDFM_URL || 'https://idfm.veligo.app';

test.describe('[AO-IDFM-JOURNEY] subscriber-onboarding', () => {

  test('Complete subscriber-onboarding journey', async ({ page }) => {
    // Step 1: Navigate to starting point
    await page.goto(`${BASE_URL}/`);

    // Step 2: User actions
    // TODO: Implement New user registers, selects plan, pays, gets bike

    // Step 3: Verify success
    await expect(page.locator('[data-testid="success-message"]')).toBeVisible();
  });

});

```

## Required Selectors
- Navigation: `[data-testid="nav-*"]`
- Forms: `[data-testid="form-*"]`
- Buttons: `[data-testid="btn-*"]`
- Status: `[data-testid="status-*"]`

## Success Criteria
- [ ] Test file created with proper structure
- [ ] All user steps implemented
- [ ] Selectors use data-testid
- [ ] Test runs without skip
- [ ] AO compliance verified

## Ralph Status Block
---RALPH_STATUS---
STATUS: COMPLETED
COMPLEXITY: medium
WSJF: 8
---END_RALPH_STATUS---

## Last Failure (Tue Jan 13 18:54:21 CET 2026)
```
<think>
Let me see more of this fixture to understand how tenant-specific tests are structured.
</think>

```bash
cat ./tests/e2e/fixtures/multi-tenant.ts
```

=== Action Results ===
bash: OK
// ============================================================================
// Multi-Tenant Test Fixture
// ============================================================================
// Extends Playwright test with tenant-aware features:
// - Automatic X-Tenant-ID header injection
// - Per-tenant test users
// - Network monitoring
// ============================================================================

import { test as base, expect, type Page, type BrowserContext } from '@playwrigh
```

## Last Failure (Tue Jan 13 18:55:14 CET 2026)
```
      "id": "IDFM-VAE-001",
      "code": "IDFM-VAE-001",
      "type": "electric",
      "model": "Veligo VAE Standard",
      "batteryLevel": 95,
      "status": "available",
      "station": "50000000-0000-0000-0000-000000000001",
      "tenant": "idfm",
      "lastMaintenance": "2025-12-15",
      "mileage": 1250,
      "features": [
        "gps",
        "antitheft",
        "lights"
      ]
    },
    {
      "id": "IDFM-VAE-002",
      "code": "IDFM-VAE-002",
      "t
```

## Last Failure (Tue Jan 13 18:55:55 CET 2026)
```
=== LLM Response ===
<think>
The output seems truncated. Let me try a different approach.
</think>

<bash>
awk '{if(NR<250) print}' tests/e2e/journeys/01-auth-journeys.spec.ts
</bash>

=== Action Results ===
bash: OK
// ============================================================================
// üîê AUTHENTICATION JOURNEYS - 10 Comprehensive Tests (Abbreviated version)
// ============================================================================
// Full RED phase implementation with real selectors, network monitoring

import { test, expect } from '../fixtures/network-monitor';
import { MailpitHelper } from '../helpers/mailpit';

const mailpit = new MailpitHelper(process.env.MAILPIT_URL || 'http://localhos
```

## Last Failure (Wed Jan 14 08:32:23 CET 2026)
```
[0;32m[AGENT] Real Agent starting[0m
[0;34m[AGENT] Task: /Users/sylvain/_LAPOSTE/_VELIGO2/tools/ralph-wiggum/tasks/T136.md[0m
[0;34m[AGENT] Queue: tdd[0m
[0;34m[AGENT] Backend: local[0m
[0;32m[AGENT] Starting task: T136[0m
[0;34m[AGENT] Iteration 1/10[0m
[0;31m[AGENT] Local LLM failed: HTTPConnectionPool(host='127.0.0.1', port=8002): Read timed out. (read timeout=300)[0m

============================================================
RESULT: FAILED
============================================================
ERROR: LLM call failed
```

## Last Failure (Wed Jan 14 08:33:32 CET 2026)
```
[0;32m[AGENT] Real Agent starting[0m
[0;34m[AGENT] Task: /Users/sylvain/_LAPOSTE/_VELIGO2/tools/ralph-wiggum/tasks/T136.md[0m
[0;34m[AGENT] Queue: tdd[0m
[0;34m[AGENT] Backend: local[0m
[0;32m[AGENT] Starting task: T136[0m
[0;34m[AGENT] Iteration 1/10[0m
[0;31m[AGENT] Local LLM failed: ('Connection aborted.', ConnectionResetError(54, 'Connection reset by peer'))[0m

============================================================
RESULT: FAILED
============================================================
ERROR: LLM call failed
```

## Last Failure (Wed Jan 14 08:33:32 CET 2026)
```
[0;32m[AGENT] Real Agent starting[0m
[0;34m[AGENT] Task: /Users/sylvain/_LAPOSTE/_VELIGO2/tools/ralph-wiggum/tasks/T136.md[0m
[0;34m[AGENT] Queue: tdd[0m
[0;34m[AGENT] Backend: local[0m
[0;32m[AGENT] Starting task: T136[0m
[0;34m[AGENT] Iteration 1/10[0m
[0;31m[AGENT] Local LLM failed: ('Connection aborted.', ConnectionResetError(54, 'Connection reset by peer'))[0m

============================================================
RESULT: FAILED
============================================================
ERROR: LLM call failed
```

## Last Failure (Wed Jan 14 08:33:38 CET 2026)
```
[0;32m[AGENT] Real Agent starting[0m
[0;34m[AGENT] Task: /Users/sylvain/_LAPOSTE/_VELIGO2/tools/ralph-wiggum/tasks/T136.md[0m
[0;34m[AGENT] Queue: tdd[0m
[0;34m[AGENT] Backend: local[0m
[0;32m[AGENT] Starting task: T136[0m
[0;34m[AGENT] Iteration 1/10[0m
[0;31m[AGENT] Local LLM failed: HTTPConnectionPool(host='127.0.0.1', port=8002): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x109138590>: Failed to establish a new connection: [Errno 61] Connection refused'))[0m

============================================================
RESULT: FAILED
============================================================
ERROR: LLM call failed
```

## Last Failure (Wed Jan 14 08:33:38 CET 2026)
```
[0;32m[AGENT] Real Agent starting[0m
[0;34m[AGENT] Task: /Users/sylvain/_LAPOSTE/_VELIGO2/tools/ralph-wiggum/tasks/T136.md[0m
[0;34m[AGENT] Queue: tdd[0m
[0;34m[AGENT] Backend: local[0m
[0;32m[AGENT] Starting task: T136[0m
[0;34m[AGENT] Iteration 1/10[0m
[0;31m[AGENT] Local LLM failed: HTTPConnectionPool(host='127.0.0.1', port=8002): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x10b0a8590>: Failed to establish a new connection: [Errno 61] Connection refused'))[0m

============================================================
RESULT: FAILED
============================================================
ERROR: LLM call failed
```

## Last Failure (Wed Jan 14 08:33:45 CET 2026)
```
[0;32m[AGENT] Real Agent starting[0m
[0;34m[AGENT] Task: /Users/sylvain/_LAPOSTE/_VELIGO2/tools/ralph-wiggum/tasks/T136.md[0m
[0;34m[AGENT] Queue: tdd[0m
[0;34m[AGENT] Backend: local[0m
[0;32m[AGENT] Starting task: T136[0m
[0;34m[AGENT] Iteration 1/10[0m
[0;31m[AGENT] Local LLM failed: HTTPConnectionPool(host='127.0.0.1', port=8002): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x1086e8590>: Failed to establish a new connection: [Errno 61] Connection refused'))[0m

============================================================
RESULT: FAILED
============================================================
ERROR: LLM call failed
```
