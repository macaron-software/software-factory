# Task T485: Annulation r√©servation avant expiration

**Priority**: P2
**WSJF Score**: 6.5
**Queue**: TDD
**Category**: JOURNEY
**Original ID**: J-E2E-010
**Phase**: üö¥ PHASE 1: JOURNEYS E2E ESSENTIELS (Priority P0)
**Section**: 1.3 Booking V√©lo

## Description
Annulation r√©servation avant expiration

## Test File
`journeys/110-cancel-before-expiry.spec.ts`

## Estimated Files
2 fichier(s) √† modifier

## Success Criteria
- [ ] Test E2E cr√©√©/modifi√©: `journeys/110-cancel-before-expiry.spec.ts`
- [ ] Test passe en local
- [ ] Pas de test.skip() sans condition
- [ ] Code review adversarial pass√©
- [ ] Pas de stubs ou TODOs

## Definition of Done (DoD)
- [ ] Feature compl√®tement impl√©ment√©e
- [ ] Tests E2E verts
- [ ] Conformit√© AO v√©rifi√©e (si applicable)
- [ ] Documentation mise √† jour

## Ralph Status Block
---RALPH_STATUS---
STATUS: FAILED
COMPLEXITY: low
WSJF: 6.5
CATEGORY: JOURNEY
ORIGINAL_ID: J-E2E-010
---END_RALPH_STATUS---

## Last Failure (Wed Jan 14 14:16:37 CET 2026)
```
-rw-------   1 sylvain  staff  31466 Dec 31 16:39 01-registration.spec.ts
-rw-------   1 sylvain  staff  10703 Dec 31 10:36 04-admin-dashboard.spec.ts
-rw-------   1 sylvain  staff  22536 Dec 31 10:36 05-rgpd.spec.ts
-rw-------   1 sylvain  staff  22354 Dec 31 10:36 06-mfa.spec.ts
-rw-------   1 sylvain  staff  12942 Dec 31 10:36 07-whitelabel.spec.ts
-rw-------   1 sylvain  staff  

=== LLM Response ===
<think>
Let me see more files in this directory to understand the test patterns and find the booking-related tests.
</think>

```bash
ls -la ./veligo-platform/frontend/tests/journeys/ | grep -E "booking|bike|110|cancel|reserv"
```

=== Action Results ===
bash: OK
-rw-------   1 sylvain  staff  13908 Dec 31 10:36 09-bike-return.spec.ts
-rw-------   1 sylvain  staff  36476 Dec 31 10:36 booking.journey.spec.ts
```

## Last Failure (Wed Jan 14 14:17:07 CET 2026)
```
    await page.goto(`${TENANTS.idfm}/bookings/active`);
    await page.waitForLoadState('networkidle');
  });

  test('B5.1 - Nominal: Cancel booking before pickup time', async ({ page }) => {
    const cancelBtn = page.locator(SELECTORS.cancel.button).first();
    const hasBooking = await cancelBtn.isVisible().catch(() => 

=== LLM Response ===
<think>
The output is being cut off. Let me try a different approach to see the full test.
</think>

```bash
awk '/Journey: Cancel Booking/,/^test\.describe/' veligo-platform/frontend/tests/journeys/booking.journey.spec.ts | head -100
```

=== Action Results ===
bash: OK
test.describe('Journey: Cancel Booking', () => {
```

## Last Failure (Wed Jan 14 14:17:48 CET 2026)
```
=== Action Results ===
bash: OK
/**
 * E2E Journey Tests - Booking Complete
 * TDD Red Phase - Real selectors, real fixtures, real API calls
 *
 * Personas tested:
 * - USER_IDFM: User with active subscription, can book bikes
 * - USER_NANTES: User with Naolib integration
 * - USER_LYON: User with TCL multimodal integration
 *
 * Journeys covered:
 * 1. Browse stations (map + list)
 * 2. Select station
 * 3. Select bike
 * 4. Choose time slot
 * 5. Confirm booking
 * 6. Pickup instructions
 * 7. Cancel booking
 * 8. Booking hi
```
