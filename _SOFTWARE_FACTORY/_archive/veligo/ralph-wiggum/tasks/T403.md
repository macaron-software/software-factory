# Task T403: Multiple sous-domaines

**Priority**: P1
**WSJF Score**: 8.5
**Queue**: TDD
**Category**: WHITE_LABEL
**Original ID**: WL-DOMAIN-001
**Phase**: üé® PHASE 3: WHITE-LABEL (Priority P1)
**Section**: 3.2 Domaines & Multi-tenant

## Description
Multiple sous-domaines

## Test File
`white-label/multi-subdomain.spec.ts`

## Estimated Files
4 fichier(s) √† modifier

## Success Criteria
- [ ] Test E2E cr√©√©/modifi√©: `white-label/multi-subdomain.spec.ts`
- [ ] Test passe en local
- [ ] Pas de test.skip() sans condition
- [ ] Code review adversarial pass√©
- [ ] Pas de stubs ou TODOs

## Definition of Done (DoD)
- [ ] Feature compl√®tement impl√©ment√©e
- [ ] Tests E2E verts
- [ ] Conformit√© AO v√©rifi√©e (si applicable)
- [ ] Documentation mise √† jour

## Ralph Status Block
---RALPH_STATUS---
STATUS: FAILED
COMPLEXITY: medium
WSJF: 8.5
CATEGORY: WHITE_LABEL
ORIGINAL_ID: WL-DOMAIN-001
---END_RALPH_STATUS---

## Last Failure (Wed Jan 14 13:29:04 CET 2026)
```

=== LLM Response ===
<think>
I see the hooks.server.ts file has tenant configuration by domain and subdomain mapping. Let me look at this file more closely to understand the current implementation.
</think>

<bash>
cat veligo-platform/frontend/src/hooks.server.ts</bash>

=== Action Results ===
bash: OK
// Veligo Platform - Server Hooks
// Tenant detection middleware + Config loading + Analytics logging
//
// TODO: Migrate to gRPC-Web when TenantConfigService and AnalyticsService protos are available.
// Currently using REST API for:
// - /api/tenants/{tenantId}/config - tenant configuration (no gRPC TenantConfigService exists)
// - /api/analytics/access - access logging (no gRPC AnalyticsService exists)
// Note: Server-side hooks run on Node.js, may need @grpc/grpc-js instead of gRPC-Web.
// S
```

## Last Failure (Wed Jan 14 13:29:42 CET 2026)
```

=== LLM Response ===
<think>
Now I have a better understanding. Let me look at the full hooks.server.ts to understand the subdomain handling and also check what test file needs to be created:
</think>

<bash>
cat veligo-platform/frontend/src/hooks.server.ts</bash>

=== Action Results ===
bash: OK
// Veligo Platform - Server Hooks
// Tenant detection middleware + Config loading + Analytics logging
//
// TODO: Migrate to gRPC-Web when TenantConfigService and AnalyticsService protos are available.
// Currently using REST API for:
// - /api/tenants/{tenantId}/config - tenant configuration (no gRPC TenantConfigService exists)
// - /api/analytics/access - access logging (no gRPC AnalyticsService exists)
// Note: Server-side hooks run on Node.js, may need @grpc/grpc-js instead of gRPC-Web.
// S
```

## Last Failure (Wed Jan 14 13:30:13 CET 2026)
```
=== Action Results ===
bash: OK
  // 1. Full domain match
  const domainMatch = TENANT_DOMAINS[hostname];
  if (domainMatch) {
    return {
      slug: domainMatch.slug,
      name: domainMatch.name,
      detected_from: 'domain',
    };
  }

  // 2. Subdomain match (e.g., idfm.veligo.app -> subdomain = 'idfm')
  const parts = hostname.split('.');
  if (parts.length >= 2) {
    const subdomain = parts[0];
    const subdomainMatch = SUBDOMAIN_TENANTS[subdomain];
    if (subdomainMatch) {
      return {
        slug: subdomainMa
```
