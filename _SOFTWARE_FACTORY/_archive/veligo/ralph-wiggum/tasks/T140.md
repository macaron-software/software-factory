# Task T140: Create E2E Journey - box-securise-booking

**Priority**: P1
**Queue**: TDD
**AO_REF**: AO-IDFM-BOOKING-3.2
**Tenant**: nantes

## Description
Missing E2E journey: box-securise-booking - User books secure box for bike

Journey: User books secure box for bike

## File to Create
tests/e2e/journeys/nantes-box-securise-booking.spec.ts

## Test Template
```typescript
import { test, expect } from '@playwright/test';
import { users } from '../fixtures/users.json';
import { stations } from '../fixtures/stations.json';

const BASE_URL = process.env.NANTES_URL || 'https://nantes.veligo.app';

test.describe('[AO-IDFM-BOOKING-3.2] box-securise-booking', () => {

  test('Complete box-securise-booking journey', async ({ page }) => {
    // Step 1: Navigate to starting point
    await page.goto(`${BASE_URL}/`);

    // Step 2: User actions
    // TODO: Implement User books secure box for bike

    // Step 3: Verify success
    await expect(page.locator('[data-testid="success-message"]')).toBeVisible();
  });

});

```

## Required Selectors
- Navigation: `[data-testid="nav-*"]`
- Forms: `[data-testid="form-*"]`
- Buttons: `[data-testid="btn-*"]`
- Status: `[data-testid="status-*"]`

## Success Criteria
- [ ] Test file created with proper structure
- [ ] All user steps implemented
- [ ] Selectors use data-testid
- [ ] Test runs without skip
- [ ] AO compliance verified

## Ralph Status Block
---RALPH_STATUS---
STATUS: COMPLETED
COMPLEXITY: medium
WSJF: 8
---END_RALPH_STATUS---

## Last Failure (Tue Jan 13 18:57:05 CET 2026)
```
=== Action Results ===
bash: OK
Folder doesn't exist

---
bash: OK
    await page.goto(`${BASE_URL}/booking/confirm`);
    await page.waitForLoadState('networkidle');

    const confirmBtn = page.locator('[data-testid="confirm-booking"], button:has-text("Confirmer")');
    if (await confirmBtn.isVisible()) {
      await confirmBtn.click();

      const error = page.locator('.alert-error, [role="alert"]');
      await expect(error).toBeVisible({ timeout: 5000 });
      await expect(error).toContainText(/disponible/i);
    }
  });

  test('should handle session e
```

## Last Failure (Tue Jan 13 18:59:43 CET 2026)
```
drwxr-xr-x  2 sylvain  staff   64 Dec 21 12:03 .
drwxr-xr-x  5 sylvain  staff  160 Dec 21 12:03 ..


=== LLM Response ===
<think>
The nantes directory is empty. Let me check the fixtures and other existing tests to understand the patterns.
</think>

<bash>
cd /Users/sylvain/_LAPOSTE/_VELIGO2 && ls -la ./tests/e2e/fixtures/ 2>/dev/null || find ./tests/e2e -name "*.json" | head -10</bash>

=== Action Results ===
bash: OK
total 32
drwxr-xr-x   5 sylvain  staff   160 Dec 25 23:51 .
drwxr-xr-x  52 sylvain  staff  1664 Jan 13 18:50 ..
-rw-------   1 sylvain  staff  4028 Dec 25 23:51 multi-tenant.ts
-rw-r--r--   1 sylvain  staff  1310 Dec 18 10:56 network-monitor.ts
-rw-------   1 sylvain  staff  7004 Dec 25 23:49 seed.sql
```

## Last Failure (Tue Jan 13 19:00:13 CET 2026)
```
=== LLM Response ===
<think>
Let me see the rest of the multi-tenant.ts file and the helper files to understand the test structure better.
</think>

<bash>
cd /Users/sylvain/_LAPOSTE/_VELIGO2 && cat ./tests/e2e/fixtures/multi-tenant.ts</bash>

=== Action Results ===
bash: OK
// ============================================================================
// Multi-Tenant Test Fixture
// ============================================================================
// Extends Playwright test with tenant-aware features:
// - Automatic X-Tenant-ID header injection
// - Per-tenant test users
// - Network monitoring
// ============================================================================

import { test as base, expect, type Page, type BrowserContext } from '@playwrigh
```

## Last Failure (Wed Jan 14 08:33:31 CET 2026)
```
   - Find and select a secure box
   - Fill out booking form
   - Confirm booking
   - Verify success message
4. Ensure all selectors use data-testid
5. Run the test to verify it works

Let me first check if the tests/e2e/journeys directory exists:

```bash
ls -la tests/e2e/journeys/
```

If it doesn't exist, I'll need to create it first.

```bash
ls -la tests/e2e/
```

ERROR: LLM call failed
```

## Last Failure (Wed Jan 14 08:33:38 CET 2026)
```
[0;32m[AGENT] Real Agent starting[0m
[0;34m[AGENT] Task: /Users/sylvain/_LAPOSTE/_VELIGO2/tools/ralph-wiggum/tasks/T140.md[0m
[0;34m[AGENT] Queue: tdd[0m
[0;34m[AGENT] Backend: local[0m
[0;32m[AGENT] Starting task: T140[0m
[0;34m[AGENT] Iteration 1/10[0m
[0;31m[AGENT] Local LLM failed: HTTPConnectionPool(host='127.0.0.1', port=8002): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x106f38590>: Failed to establish a new connection: [Errno 61] Connection refused'))[0m

============================================================
RESULT: FAILED
============================================================
ERROR: LLM call failed
```

## Last Failure (Wed Jan 14 08:33:44 CET 2026)
```
[0;32m[AGENT] Real Agent starting[0m
[0;34m[AGENT] Task: /Users/sylvain/_LAPOSTE/_VELIGO2/tools/ralph-wiggum/tasks/T140.md[0m
[0;34m[AGENT] Queue: tdd[0m
[0;34m[AGENT] Backend: local[0m
[0;32m[AGENT] Starting task: T140[0m
[0;34m[AGENT] Iteration 1/10[0m
[0;31m[AGENT] Local LLM failed: HTTPConnectionPool(host='127.0.0.1', port=8002): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x10aa10590>: Failed to establish a new connection: [Errno 61] Connection refused'))[0m

============================================================
RESULT: FAILED
============================================================
ERROR: LLM call failed
```
