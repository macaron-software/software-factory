# Project Configuration Template
# ===============================
# Copy this file and rename to <project>.yaml

project:
  name: my-project                    # Unique identifier
  display_name: "My Project"          # Human-readable name
  root_path: /path/to/project         # Absolute path to project root
  vision_doc: CLAUDE.md               # Vision document filename

# Domain configurations
# Define one or more domains with their paths, extensions, and commands
domains:
  # Example: TypeScript domain
  typescript:
    paths:
      - src/
    extensions:
      - .ts
      - .tsx
    build_cmd: npm run build
    test_cmd: npm run test
    lint_cmd: npm run lint

  # Example: Rust domain
  # rust:
  #   paths:
  #     - backend/
  #   extensions:
  #     - .rs
  #   build_cmd: cargo build
  #   test_cmd: cargo test

# Deployment configuration
deploy:
  strategy: validation-only           # blue-green | canary | validation-only
  auto_prod: false                    # Automatic production deployment
  # staging:
  #   url: https://staging.example.com
  #   health: /health
  # prod:
  #   url: https://example.com
  #   health: /health
  rollback_on_fail: true
  # gate_approval: false              # Require human approval

# FRACTAL decomposition thresholds
fractal:
  max_files: 5                        # Max files per atomic task
  max_loc: 400                        # Max LOC estimate per task
  max_items: 10                       # Max acceptance criteria
  max_depth: 3                        # Max recursion depth

# Adversarial gate configuration (100% LLM - no regex)
adversarial:
  threshold: 5                        # Score threshold for rejection (LLM decides)

# Global Build Queue (cross-project job serialization)
# Prevents CPU/IO saturation by running builds/tests sequentially
# Daemon auto-starts when first build is triggered
build_queue:
  enabled: true                       # Use global queue (default: true)
  priority: 10                        # WSJF priority (higher = first)
  timeout: 300                        # Per-job timeout in seconds

# Multi-tenant configuration (optional)
# tenants:
#   - name: tenant1
#     staging_url: https://staging-tenant1.example.com
#     prod_url: https://tenant1.example.com

# MCP servers (optional)
# mcp:
#   custom:
#     server: mcp_custom_server.py
#     tools:
#       - custom_tool

# AO compliance (optional)
# ao_compliance:
#   enabled: false
#   refs_file: AO_TRACEABILITY.md

# Error Capture Configuration (RLM Feedback Loop)
# Captures errors from build, E2E, and mobile tests
# Feeds errors back to TDD backlog as new tasks
error_capture:
  enabled: true                         # Enable error capture
  feedback_to_backlog: true             # Create tasks from errors
  deduplicate: true                     # Skip duplicate errors

  # Build error sources
  build:
    enabled: true
    domains: []                         # All domains by default
    # domains: [rust, typescript]       # Or specific domains

  # E2E test error sources
  e2e:
    enabled: true
    playwright:
      report_path: playwright-report/   # JSON report location
      fail_on_console_error: false      # Fail tests on console.error
      capture_grpc: true                # Capture gRPC errors
    # detox:                            # React Native E2E
    #   enabled: false
    # xcuitest:                         # iOS native E2E
    #   enabled: false
    # espresso:                         # Android native E2E
    #   enabled: false

  # Mobile app error capture
  mobile:
    enabled: false                      # Enable mobile capture
    # ios:
    #   bundle_id: com.example.app      # iOS app bundle ID
    #   capture_duration: 10            # Seconds to capture logs
    # android:
    #   package_name: com.example.app   # Android package name
    #   capture_duration: 10            # Seconds to capture logs
    #   device_id: null                 # Optional specific device

  # Error severity thresholds
  severity:
    create_task_min: medium             # Minimum severity to create task
    # critical, high, medium, low

# Active analyzers
analyzers: []
  # - rust
  # - typescript
  # - playwright
  # - security

# Architecture Guidelines (optional)
# Scrape your org wiki to inject guidelines into agent system prompts.
# Run: python -m mcp_lrm.guidelines_scraper --source confluence --space MYSPACE --project <project_id>
# guidelines:
#   enabled: true
#   source: confluence          # confluence | gitlab | markdown
#   space: MYSPACE              # Confluence space key
#   confluence_url: ""          # e.g. https://confluence.myorg.com
#   token_env: CONFLUENCE_TOKEN # env var with API token
#   auto_inject: true           # inject in dev/arch/security agent prompts
#   scrape_frequency: weekly
