# Logs Facteur - Palm/Preliv Log Analyzer
# =========================================
# Support N1 La Poste: analyse des logs facteurs Android (Palm + Preliv)
# Azure VM: 20.199.122.243 (production)

project:
  name: logs-facteur
  display_name: "Logs Facteur - Support N1 La Poste"
  root_path: /Users/sylvain/_LAPOSTE/_LOGS
  vision_doc: CLAUDE.md

# Domain configurations
domains:
  python:
    paths:
      - palm_log_analyzer/
    extensions:
      - .py
    build_cmd: python -c "import palm_log_analyzer; print('OK')"
    test_cmd: pytest tests/ -v
    lint_cmd: ruff check palm_log_analyzer/

  html:
    paths:
      - palm_log_analyzer/web/templates/
    extensions:
      - .html
      - .css
      - .js

# Knowledge sources (injected into LLM agents)
# These files contain verified Markov data from real DB analysis
knowledge:
  # Palm: 362K events, 30 event types
  # Preliv: 34M log lines, 224 tags, 460 device-days
  markov_knowledge: palm_log_analyzer/llm/knowledge.py
  agent_prompts: palm_log_analyzer/llm/prompts.py
  agent_tools: palm_log_analyzer/llm/agent.py
  db_layer: palm_log_analyzer/db/palm_db.py
  web_server: palm_log_analyzer/support_debug.py
  dashboard_v2: palm_log_analyzer/web/templates/dashboard_v2.html

# Remote deployment (Azure VM)
deploy:
  strategy: validation-only
  auto_prod: false
  prod:
    url: http://20.199.122.243
    health: /login
  rollback_on_fail: true
  # Deployment = scp files + docker rebuild
  # cp palm_log_analyzer/support_debug.py support_debug.py (root copy for Dockerfile)
  # sudo docker compose down && sudo docker compose build --no-cache && sudo docker compose up -d

# Data architecture
# =================
# DuckDB: palm_full.duckdb
#   Tables: device, session, event, log_line
#   Palm: 362K events in `event`, logs in `log_line`
#   Preliv: 252K FLASH in `event` (noise), 34M real logs in `log_line`
#
# Key insight: Preliv data is almost entirely in log_line, NOT event table
# 81 Preliv devices have ZERO entries in event table
#
# Markov verified transitions (knowledge.py):
#   Palm: ADDED→AFFECTED_ROUND_AFTER_ADDED_OBJECT (79.6%) → PARTID_AFTER_ADDED_OBJECT (79.8%) → reboucle (64.2%)
#   Preliv: 4 business loops (SCAN, API, MISSION, PICKING), ZebraDatawedgeHelper = 23% noise

# FRACTAL decomposition thresholds
fractal:
  max_files: 5
  max_loc: 400
  max_items: 10
  max_depth: 3

# Adversarial gate
adversarial:
  threshold: 5

# Error capture
error_capture:
  enabled: true
  feedback_to_backlog: true
  deduplicate: true
  build:
    enabled: true
    domains: [python]
  severity:
    create_task_min: medium

# Active analyzers
analyzers:
  - security
