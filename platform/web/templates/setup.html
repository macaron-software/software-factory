<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <script>document.documentElement.setAttribute('data-theme', localStorage.getItem('macaron_theme') || 'dark')</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup ‚Äî Software Factory</title>
    <link rel="stylesheet" href="/static/css/main.css?v=20260223">
    <style>
        body { display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; background: var(--bg-primary, #0d1117); }
        .setup-box { width: 100%; max-width: 440px; padding: 2rem; }
        .setup-logo { text-align: center; margin-bottom: 2rem; }
        .setup-logo h1 { font-size: 1.5rem; color: var(--text-primary, #e6edf3); margin: 0; }
        .setup-logo p { color: var(--text-secondary, #8b949e); font-size: 0.875rem; margin: 0.5rem 0 0; line-height: 1.5; }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; font-size: 0.875rem; color: var(--text-secondary, #8b949e); margin-bottom: 0.375rem; }
        .form-group input { width: 100%; padding: 0.625rem 0.75rem; font-size: 0.875rem; background: var(--bg-secondary, #161b22); border: 1px solid var(--border-primary, #30363d); border-radius: 6px; color: var(--text-primary, #e6edf3); outline: none; box-sizing: border-box; }
        .form-group input:focus { border-color: var(--accent, #58a6ff); box-shadow: 0 0 0 3px rgba(88,166,255,.15); }
        .form-group small { color: var(--text-secondary, #8b949e); font-size: 0.75rem; }
        .btn-setup { width: 100%; padding: 0.75rem; font-size: 0.875rem; font-weight: 600; background: var(--accent, #238636); color: #fff; border: none; border-radius: 6px; cursor: pointer; margin-bottom: 0.75rem; }
        .btn-setup:hover { opacity: 0.9; }
        .btn-setup:disabled { opacity: 0.5; cursor: wait; }
        .btn-demo { width: 100%; padding: 0.75rem; font-size: 0.875rem; font-weight: 500; background: transparent; color: var(--text-secondary, #8b949e); border: 1px solid var(--border-primary, #30363d); border-radius: 6px; cursor: pointer; }
        .btn-demo:hover { border-color: var(--accent, #58a6ff); color: var(--text-primary, #e6edf3); }
        .separator { display: flex; align-items: center; margin: 1.25rem 0; color: var(--text-secondary, #8b949e); font-size: 0.75rem; }
        .separator::before, .separator::after { content: ''; flex: 1; border-top: 1px solid var(--border-primary, #30363d); }
        .separator span { padding: 0 0.75rem; }
        .error-msg { color: #f85149; font-size: 0.8125rem; margin-top: 0.75rem; text-align: center; display: none; padding: 0.5rem; background: rgba(248,81,73,.1); border-radius: 6px; }
        .error-msg.show { display: block; }
        .step-indicator { text-align: center; color: var(--text-secondary, #8b949e); font-size: 0.75rem; margin-bottom: 1.5rem; }
    </style>
</head>
<body>
    <div class="setup-box">
        <div class="setup-logo">
            <h1>üè≠ Software Factory</h1>
            <p>Welcome! Create your administrator account to get started.</p>
        </div>
        <div class="step-indicator">Step 1 of 1 ‚Äî Admin Account</div>
        <form id="setupForm" onsubmit="return handleSetup(event)">
            <div class="form-group">
                <label for="display_name">Display Name</label>
                <input type="text" id="display_name" name="display_name" required autofocus placeholder="Your name">
            </div>
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" required placeholder="admin@company.com" autocomplete="email">
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" name="password" required minlength="8" autocomplete="new-password">
                <small>Minimum 8 characters</small>
            </div>
            <div class="form-group">
                <label for="password2">Confirm Password</label>
                <input type="password" id="password2" name="password2" required minlength="8" autocomplete="new-password">
            </div>
            <button type="submit" class="btn-setup" id="setupBtn">Create Admin Account</button>
            <div class="error-msg" id="errorMsg"></div>
        </form>
        <div class="separator"><span>or</span></div>
        <button class="btn-demo" id="demoBtn" onclick="handleDemo()">‚ö° Skip ‚Äî Enter Demo Mode</button>
    </div>
    <script>
    async function handleSetup(e) {
        e.preventDefault();
        const btn = document.getElementById('setupBtn');
        const err = document.getElementById('errorMsg');
        const pw1 = document.getElementById('password').value;
        const pw2 = document.getElementById('password2').value;

        if (pw1 !== pw2) {
            err.textContent = 'Passwords do not match';
            err.classList.add('show');
            return false;
        }

        btn.disabled = true;
        btn.textContent = 'Creating...';
        err.classList.remove('show');

        try {
            const resp = await fetch('/api/auth/setup', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    email: document.getElementById('email').value,
                    password: pw1,
                    display_name: document.getElementById('display_name').value,
                }),
            });
            const data = await resp.json();
            if (data.ok) {
                location.href = '/';
            } else {
                err.textContent = data.error || 'Setup failed';
                err.classList.add('show');
            }
        } catch (ex) {
            err.textContent = 'Network error: ' + ex.message;
            err.classList.add('show');
        }
        btn.disabled = false;
        btn.textContent = 'Create Admin Account';
        return false;
    }

    async function handleDemo() {
        const btn = document.getElementById('demoBtn');
        const err = document.getElementById('errorMsg');
        btn.disabled = true;
        btn.textContent = 'Entering demo mode...';
        err.classList.remove('show');

        try {
            const resp = await fetch('/api/auth/demo', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
            });
            const data = await resp.json();
            if (data.ok) {
                location.href = '/';
            } else {
                err.textContent = data.error || 'Demo login failed';
                err.classList.add('show');
            }
        } catch (ex) {
            err.textContent = 'Network error: ' + ex.message;
            err.classList.add('show');
        }
        btn.disabled = false;
        btn.textContent = '‚ö° Skip ‚Äî Enter Demo Mode';
    }
    </script>
</body>
</html>
