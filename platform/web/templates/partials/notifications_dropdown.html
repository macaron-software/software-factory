<div class="notif-header">
    <h4>Notifications{% if unread %} ({{ unread }}){% endif %}</h4>
    {% if unread %}
    <button class="notif-mark-all"
            hx-post="/api/notifications/read-all"
            hx-swap="none"
            hx-on::after-request="htmx.trigger(document.getElementById('notifDropdown'),'notif-open'); htmx.trigger(document.getElementById('notifBadge'),'htmx:load')">
        Mark all read
    </button>
    {% endif %}
</div>
<div class="notif-list">
    {% if notifications %}
        {% for n in notifications %}
        <div class="notif-item {% if not n.is_read %}unread{% endif %}"
             {% if n.url %}onclick="window.location='{{ n.url }}'"{% endif %}
             {% if not n.is_read %}
             hx-post="/api/notifications/{{ n.id }}/read"
             hx-swap="none"
             hx-trigger="click once"
             {% endif %}>
            <div class="notif-sev {{ n.severity }}"></div>
            <div class="notif-dot"></div>
            <div class="notif-body">
                <div class="notif-title">{{ n.title }}</div>
                {% if n.message %}<div class="notif-msg">{{ n.message }}</div>{% endif %}
                <div class="notif-time">{{ n.created_at[:16] | replace('T', ' ') }}</div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="notif-empty">No notifications yet</div>
    {% endif %}
</div>
<div class="notif-footer">
    <a href="/notifications">View all notifications</a>
</div>
