<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <script>document.documentElement.setAttribute('data-theme', localStorage.getItem('macaron_theme') || 'dark')</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login â€” Software Factory</title>
    <link rel="stylesheet" href="/static/css/main.css?v=20260222">
    <style>
        body { display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; background: var(--bg-primary, #0d1117); }
        .login-box { width: 100%; max-width: 400px; padding: 2rem; }
        .login-logo { text-align: center; margin-bottom: 2rem; }
        .login-logo h1 { font-size: 1.5rem; color: var(--text-primary, #e6edf3); margin: 0; }
        .login-logo p { color: var(--text-secondary, #8b949e); font-size: 0.875rem; margin: 0.25rem 0 0; }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; font-size: 0.875rem; color: var(--text-secondary, #8b949e); margin-bottom: 0.375rem; }
        .form-group input { width: 100%; padding: 0.625rem 0.75rem; font-size: 0.875rem; background: var(--bg-secondary, #161b22); border: 1px solid var(--border-primary, #30363d); border-radius: 6px; color: var(--text-primary, #e6edf3); outline: none; box-sizing: border-box; }
        .form-group input:focus { border-color: var(--accent, #58a6ff); box-shadow: 0 0 0 3px rgba(88,166,255,.15); }
        .btn-login { width: 100%; padding: 0.75rem; font-size: 0.875rem; font-weight: 600; background: var(--accent, #238636); color: #fff; border: none; border-radius: 6px; cursor: pointer; }
        .btn-login:hover { opacity: 0.9; }
        .btn-login:disabled { opacity: 0.5; cursor: wait; }
        .error-msg { color: #f85149; font-size: 0.8125rem; margin-top: 1rem; text-align: center; display: none; }
        .error-msg.show { display: block; }
    </style>
    <script async src="https://analytics.macaron-software.com/script.js" data-website-id="fddc91d3-a7fe-4544-85df-46b16597e143"></script>
</head>
<body>
    <div class="login-box">
        <div class="login-logo">
            <h1>Software Factory</h1>
            <p>Sign in to your account</p>
        </div>
        <form id="loginForm" onsubmit="return handleLogin(event)">
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" required autofocus autocomplete="email">
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" name="password" required autocomplete="current-password">
            </div>
            <button type="submit" class="btn-login" id="loginBtn">Sign in</button>
            <div class="error-msg" id="errorMsg"></div>
        </form>
        <div style="margin-top:1rem;text-align:center">
            <button onclick="demoLogin()" style="background:none;border:1px solid var(--border-primary,#30363d);color:var(--text-secondary,#8b949e);padding:0.5rem 1.25rem;border-radius:6px;cursor:pointer;font-size:0.8125rem">Skip (Demo)</button>
        </div>
        <div style="margin-top:1.5rem;border-top:1px solid var(--border-primary,#30363d);padding-top:1.25rem">
            <p style="text-align:center;font-size:0.8125rem;color:var(--text-secondary,#8b949e);margin:0 0 0.75rem">Or sign in with</p>
            <div style="display:flex;gap:0.5rem">
                <a href="/auth/github" style="flex:1;display:flex;align-items:center;justify-content:center;gap:0.5rem;padding:0.6rem;border:1px solid var(--border-primary,#30363d);border-radius:6px;color:var(--text-primary,#e6edf3);text-decoration:none;font-size:0.8125rem;font-weight:600">
                    <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
                    GitHub
                </a>
                <a href="/auth/azure" style="flex:1;display:flex;align-items:center;justify-content:center;gap:0.5rem;padding:0.6rem;border:1px solid var(--border-primary,#30363d);border-radius:6px;color:var(--text-primary,#e6edf3);text-decoration:none;font-size:0.8125rem;font-weight:600">
                    <svg width="18" height="18" viewBox="0 0 23 23" fill="none"><path d="M1 1h10v10H1z" fill="#f25022"/><path d="M12 1h10v10H12z" fill="#7fba00"/><path d="M1 12h10v10H1z" fill="#00a4ef"/><path d="M12 12h10v10H12z" fill="#ffb900"/></svg>
                    Microsoft
                </a>
            </div>
        </div>
    </div>
    <script>
    async function demoLogin() {
        try {
            const resp = await fetch('/api/auth/demo', {method:'POST'});
            const data = await resp.json();
            if (data.ok) { location.href = new URLSearchParams(location.search).get('next') || '/'; }
            else { document.getElementById('errorMsg').textContent = data.error; document.getElementById('errorMsg').classList.add('show'); }
        } catch(ex) { document.getElementById('errorMsg').textContent = 'Network error'; document.getElementById('errorMsg').classList.add('show'); }
    }
    async function handleLogin(e) {
        e.preventDefault();
        const btn = document.getElementById('loginBtn');
        const err = document.getElementById('errorMsg');
        btn.disabled = true;
        err.classList.remove('show');
        try {
            const resp = await fetch('/api/auth/login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    email: document.getElementById('email').value,
                    password: document.getElementById('password').value,
                }),
            });
            const data = await resp.json();
            if (data.ok) {
                const next = new URLSearchParams(location.search).get('next') || '/';
                location.href = next;
            } else {
                err.textContent = data.error || 'Login failed';
                err.classList.add('show');
            }
        } catch (ex) {
            err.textContent = 'Network error';
            err.classList.add('show');
        }
        btn.disabled = false;
        return false;
    }
    </script>
</body>
</html>
