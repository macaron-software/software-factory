{% extends "base.html" %}

{% block topbar_actions %}
{% if unread %}
<button class="btn btn-sm btn-secondary"
        hx-post="/api/notifications/read-all"
        hx-swap="none"
        hx-on::after-request="location.reload()">
    Mark all as read ({{ unread }})
</button>
{% endif %}
{% endblock %}

{% block content %}
<div class="notifications-page">
    {% if notifications %}
    <div class="notif-full-list">
        {% for n in notifications %}
        <div class="notif-full-item {% if not n.is_read %}unread{% endif %}"
             {% if not n.is_read %}
             hx-post="/api/notifications/{{ n.id }}/read"
             hx-swap="none"
             hx-trigger="click once"
             {% endif %}>
            <div class="notif-sev {{ n.severity }}" style="width:4px;min-height:100%;border-radius:2px"></div>
            {% if not n.is_read %}<div class="notif-dot"></div>{% endif %}
            <div style="flex:1;min-width:0">
                <div style="display:flex;align-items:center;gap:8px">
                    <span class="notif-type-tag">{{ n.type }}</span>
                    <span class="notif-title" style="font-size:13px">{{ n.title }}</span>
                    <span style="margin-left:auto;font-size:11px;color:var(--text-secondary);white-space:nowrap">{{ n.created_at[:16] | replace('T', ' ') }}</span>
                </div>
                {% if n.message %}
                <div style="font-size:12px;color:var(--text-secondary);margin-top:4px">{{ n.message }}</div>
                {% endif %}
                {% if n.url %}
                <a href="{{ n.url }}" style="font-size:11px;color:var(--purple-light);margin-top:4px;display:inline-block">View details</a>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state" style="text-align:center;padding:60px 20px">
        <svg class="icon" style="width:48px;height:48px;color:var(--text-secondary);margin-bottom:16px"><use href="#icon-bell"/></svg>
        <h3 style="color:var(--text-secondary);margin:0">No notifications</h3>
        <p style="color:var(--text-secondary);font-size:13px;margin-top:8px">Notifications from missions, auto-heal, and system events will appear here.</p>
    </div>
    {% endif %}
</div>

<style>
.notifications-page{max-width:720px;margin:0 auto}
.notif-full-list{display:flex;flex-direction:column;gap:2px}
.notif-full-item{display:flex;gap:10px;padding:12px 16px;background:var(--bg-secondary);border-radius:var(--radius);cursor:pointer;transition:background .1s}
.notif-full-item:hover{background:var(--bg-tertiary)}
.notif-full-item.unread{background:rgba(168,85,247,.08)}
.notif-type-tag{font-size:10px;text-transform:uppercase;padding:1px 6px;border-radius:4px;background:var(--bg-tertiary);color:var(--text-secondary);font-weight:600;letter-spacing:.5px}
</style>
{% endblock %}
