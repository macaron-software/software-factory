/* ── Ideation Workspace ── */
.idea-layout{display:grid;grid-template-columns:1fr 340px;gap:1rem;height:calc(100vh - 70px);padding:0.5rem 0}
@media(max-width:900px){.idea-layout{grid-template-columns:1fr;grid-template-rows:1fr auto}}
@keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
.spin{animation:spin 1s linear infinite}

/* Chat area */
.idea-chat{display:flex;flex-direction:column;background:var(--bg-secondary);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden}
.idea-messages{flex:1;overflow-y:auto;padding:1rem;display:flex;flex-direction:column;gap:0.75rem}

.idea-msg{display:flex;gap:0.6rem;max-width:85%}
.idea-msg.user{align-self:flex-end;flex-direction:row-reverse}
/* Ideation messages now use unified .mu--chat from components.css */

/* Placeholder */
.idea-empty{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:var(--text-secondary);gap:0.75rem;text-align:center;padding:2rem}
.idea-empty svg{width:48px;height:48px;opacity:.25}
.idea-empty-title{font-size:1rem;font-weight:600;color:var(--text-primary)}
.idea-empty-subtitle{font-size:0.82rem;max-width:400px;line-height:1.5}

/* Examples */
.idea-examples{display:flex;gap:0.5rem;flex-wrap:wrap;justify-content:center;margin-top:0.5rem}
.idea-example{padding:0.35rem 0.65rem;border:1px solid var(--border);border-radius:6px;font-size:0.75rem;cursor:pointer;color:var(--text-secondary);transition:all .15s;background:var(--bg-tertiary)}
.idea-example:hover{border-color:var(--purple);color:var(--purple)}

/* Input bar */
.idea-input-bar{display:flex;gap:0.5rem;padding:0.65rem;border-top:1px solid var(--border);background:var(--bg-tertiary)}
.idea-input{flex:1;background:var(--bg-secondary);border:1px solid var(--border);border-radius:8px;padding:0.55rem 0.75rem;color:var(--text-primary);font-size:0.85rem;outline:none;resize:none;min-height:40px;max-height:120px;font-family:inherit}
.idea-input:focus{border-color:var(--purple)}
.idea-send{width:40px;height:40px;border-radius:8px;border:none;background:var(--purple);color:white;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:opacity .15s;flex-shrink:0}
.idea-send:hover{opacity:.85}
.idea-send:disabled{opacity:.4;cursor:not-allowed}
.idea-send svg{width:18px;height:18px}

/* Right panel — agents + output */
.idea-panel{display:flex;flex-direction:column;gap:0.75rem;overflow-y:auto}

/* Agent roster */
.idea-agents{background:var(--bg-secondary);border:1px solid var(--border);border-radius:var(--radius);padding:0.6rem}
.idea-agents-title{font-size:0.72rem;font-weight:700;color:var(--text-secondary);text-transform:uppercase;letter-spacing:.5px;margin-bottom:0.5rem;display:flex;align-items:center;gap:0.4rem}
.idea-agents-title svg{width:14px;height:14px}
.idea-agent-row{display:flex;align-items:center;gap:0.5rem;padding:0.35rem 0;border-bottom:1px solid rgba(255,255,255,.04)}
.idea-agent-row:last-child{border-bottom:none}
.idea-agent-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.idea-agent-dot.idle{background:#6b7280}
.idea-agent-dot.thinking{background:var(--yellow);animation:pulse 1.5s infinite}
.idea-agent-dot.speaking{background:var(--green)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
@keyframes typingPulse{0%{opacity:.2}20%{opacity:1}100%{opacity:.2}}
.typing-indicator{display:inline-flex;gap:3px;padding:4px 0}
.typing-indicator span{width:6px;height:6px;border-radius:50%;background:var(--text-secondary);animation:typingPulse 1.4s infinite}
.typing-indicator span:nth-child(2){animation-delay:.2s}
.typing-indicator span:nth-child(3){animation-delay:.4s}

/* Markdown in agent bubbles */
.mu__content h2,.mu__content h3,.mu__content h4{margin:0.6em 0 0.3em;color:var(--text-primary);line-height:1.3}
.mu__content h2{font-size:1.05rem}
.mu__content h3{font-size:0.95rem}
.mu__content h4{font-size:0.88rem}
.mu__content ul{margin:0.3em 0;padding-left:1.4em}
.mu__content li{margin:0.15em 0}
.mu__content table{border-collapse:collapse;margin:0.5em 0;font-size:0.82rem;width:100%}
.mu__content th,.mu__content td{border:1px solid var(--border);padding:0.3em 0.6em;text-align:left}
.mu__content th{background:var(--bg-tertiary);font-weight:600}
.mu__content pre{background:var(--bg-primary);border:1px solid var(--border);border-radius:6px;padding:0.5em;margin:0.4em 0;overflow-x:auto;font-size:0.82rem}
.mu__content code{background:var(--bg-tertiary);padding:0.1em 0.3em;border-radius:3px;font-size:0.88em}
.mu__content pre code{background:none;padding:0}
.mu__content hr{border:none;border-top:1px solid var(--border);margin:0.6em 0}
.mu__content strong{color:var(--text-primary)}
/* Metadata tags (pattern, flow, recipient) */
.mu__meta{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:4px;padding:0 2px}
.mu__tag{font-size:0.68rem;padding:1px 7px;border-radius:10px;font-weight:500;line-height:1.4}
.mu__tag--pattern{background:var(--purple);color:#fff;opacity:.85}
.mu__tag--flow{background:var(--bg-tertiary);color:var(--text-secondary);border:1px solid var(--border)}
.mu__tag--to{background:transparent;color:var(--purple-light);font-weight:600}
.idea-agent-label{font-size:0.78rem;flex:1}
.idea-agent-role{font-size:0.68rem;color:var(--text-secondary)}

/* Structured output cards */
.idea-output{background:var(--bg-secondary);border:1px solid var(--border);border-radius:var(--radius);padding:0.6rem}
.idea-output-title{font-size:0.72rem;font-weight:700;color:var(--text-secondary);text-transform:uppercase;letter-spacing:.5px;margin-bottom:0.5rem;display:flex;align-items:center;gap:0.4rem}
.idea-output-title svg{width:14px;height:14px}
.idea-output-empty{font-size:0.78rem;color:var(--text-secondary);font-style:italic;padding:0.5rem 0}

.idea-finding{padding:0.45rem 0.6rem;margin-bottom:0.4rem;border-radius:6px;border:1px solid var(--border);font-size:0.78rem}
.idea-finding-type{font-size:0.65rem;text-transform:uppercase;font-weight:700;letter-spacing:.5px;margin-bottom:0.15rem}
.idea-finding-type.opportunity{color:var(--green)}
.idea-finding-type.risk{color:var(--red)}
.idea-finding-type.question{color:var(--yellow)}
.idea-finding-type.decision{color:var(--purple)}
.idea-finding-type.feature{color:var(--blue)}
.idea-finding-text{color:var(--text-primary);line-height:1.4}

.section-title{font-size:0.82rem;font-weight:700;color:var(--text-secondary);text-transform:uppercase;letter-spacing:1px;margin-bottom:0.75rem;display:flex;align-items:center;gap:0.5rem}
.section-title svg{width:16px;height:16px}

/* ── Ideation Graph ── */
.idea-graph{background:var(--bg-secondary);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden}
.idea-graph-header{display:flex;align-items:center;justify-content:space-between;padding:0.5rem 0.6rem;cursor:pointer;user-select:none}
.idea-graph-header:hover{background:var(--bg-tertiary)}
.idea-graph-title{font-size:0.72rem;font-weight:700;color:var(--text-secondary);text-transform:uppercase;letter-spacing:.5px;display:flex;align-items:center;gap:0.4rem}
.idea-graph-title svg{width:14px;height:14px}
.idea-graph-toggle{width:16px;height:16px;color:var(--text-secondary);transition:transform .2s}
.idea-graph-toggle.open{transform:rotate(180deg)}
.idea-graph-canvas{height:320px;position:relative;overflow:hidden;cursor:grab;background:var(--bg-primary);border-top:1px solid var(--border)}
.idea-graph-canvas.panning{cursor:grabbing}
.idea-graph-canvas svg{width:100%;height:100%}
.idea-graph-legend{display:flex;gap:0.75rem;padding:0.35rem 0.6rem;border-top:1px solid var(--border);flex-wrap:wrap}
.idea-graph-legend-item{display:flex;align-items:center;gap:0.3rem;font-size:0.65rem;color:var(--text-secondary)}
/* Nodes */
.ig-node{cursor:pointer}
.ig-node:hover .ig-node-bg{filter:brightness(1.15)}
.ig-node-bg{fill:var(--bg-secondary);stroke:var(--border);stroke-width:1;rx:8;ry:8}
.ig-node-bar{stroke-linecap:round}
.ig-node-name{font-size:11px;fill:var(--text-primary);font-weight:600}
.ig-node-role{font-size:9px;fill:var(--text-secondary)}
.ig-node-dot{r:4}
/* Edges */
.ig-edge{fill:none;stroke-width:1.8;opacity:0.6}
.ig-edge.active{opacity:1;stroke-width:2.5;filter:drop-shadow(0 0 4px currentColor)}
.ig-edge-label{font-size:8px;fill:var(--text-secondary);text-anchor:middle}
/* Node active state */
.ig-node.active .ig-node-bg{filter:brightness(1.3);stroke:var(--purple);stroke-width:2}
.ig-node.active .ig-node-dot{r:6;filter:drop-shadow(0 0 6px currentColor)}
@keyframes igPulse{0%,100%{opacity:1}50%{opacity:.3}}
.ig-node.thinking .ig-node-dot{animation:igPulse 1s infinite;fill:var(--yellow) !important}
/* Edge flow animation */
@keyframes igFlowDash{to{stroke-dashoffset:-20}}
.ig-edge.flowing{animation:igFlowDash .8s linear infinite;stroke-dasharray:6 4;opacity:1;stroke-width:2.5}
/* Popover */
.ig-popover-overlay{position:fixed;inset:0;z-index:500;background:rgba(0,0,0,.3);display:none}
.ig-popover-overlay.visible{display:block}
.ig-popover{position:fixed;z-index:501;width:320px;max-height:70vh;background:var(--bg-secondary);border:1px solid var(--border);border-radius:var(--radius);box-shadow:0 12px 40px rgba(0,0,0,.4);overflow-y:auto;display:none}
.ig-popover.visible{display:block}
.ig-popover-header{display:flex;align-items:center;gap:0.6rem;padding:0.75rem;border-bottom:1px solid var(--border)}
.ig-popover-avatar{width:40px;height:40px;border-radius:50%;flex-shrink:0;object-fit:cover}
.ig-popover-avatar-fallback{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:1rem;color:#fff;flex-shrink:0}
.ig-popover-info{flex:1;min-width:0}
.ig-popover-name{font-size:0.88rem;font-weight:700;color:var(--text-primary)}
.ig-popover-role{font-size:0.72rem;color:var(--text-secondary)}
.ig-popover-close{background:none;border:none;color:var(--text-secondary);cursor:pointer;padding:0.25rem}
.ig-popover-close:hover{color:var(--text-primary)}
.ig-popover-body{padding:0.6rem 0.75rem;display:flex;flex-direction:column;gap:0.5rem}
.ig-popover-section-title{font-size:0.68rem;font-weight:700;color:var(--text-secondary);text-transform:uppercase;letter-spacing:.4px;display:flex;align-items:center;gap:0.3rem;margin-bottom:0.2rem}
.ig-popover-section-title svg{width:12px;height:12px}
.ig-popover-text{font-size:0.78rem;color:var(--text-primary);line-height:1.5;white-space:pre-line}
.ig-popover-tags{display:flex;flex-wrap:wrap;gap:0.3rem}
.ig-popover-tag{font-size:0.68rem;padding:0.15rem 0.4rem;border-radius:4px;background:var(--bg-tertiary);border:1px solid var(--border);color:var(--text-secondary)}
.ig-popover-tag.skill{border-color:rgba(139,92,246,.3);color:#a78bfa}
.ig-popover-tag.tool{border-color:rgba(16,185,129,.3);color:#34d399}
/* History sidebar */
.idea-history-btn{position:absolute;top:0.5rem;left:0.5rem;z-index:10;background:var(--bg-tertiary);border:1px solid var(--border);border-radius:var(--radius-sm);padding:0.3rem 0.5rem;cursor:pointer;color:var(--text-secondary);font-size:0.7rem;display:flex;align-items:center;gap:0.3rem;transition:color 0.15s}
.idea-history-btn:hover{color:var(--text-primary);border-color:var(--purple)}
.idea-history-btn svg{width:14px;height:14px}
.idea-sidebar{position:absolute;top:0;left:0;width:260px;height:100%;background:var(--bg-secondary);border-right:1px solid var(--border);z-index:9;transform:translateX(-100%);transition:transform 0.2s;overflow-y:auto;display:flex;flex-direction:column}
.idea-sidebar.open{transform:translateX(0)}
.idea-sidebar-header{padding:0.5rem 0.6rem;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.idea-sidebar-title{font-size:0.75rem;font-weight:600;color:var(--text-secondary)}
.idea-sidebar-close{background:none;border:none;color:var(--text-tertiary);cursor:pointer;padding:0.2rem}
.idea-sidebar-list{flex:1;overflow-y:auto;padding:0.4rem}
.idea-sidebar-item{padding:0.4rem 0.5rem;border-radius:var(--radius-sm);cursor:pointer;margin-bottom:0.2rem;transition:background 0.15s;border:1px solid transparent}
.idea-sidebar-item:hover{background:var(--bg-tertiary);border-color:var(--border)}
.idea-sidebar-item-title{font-size:0.72rem;font-weight:600;color:var(--text-primary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.idea-sidebar-item-meta{font-size:0.6rem;color:var(--text-tertiary);display:flex;align-items:center;gap:0.3rem;margin-top:0.1rem}
.idea-sidebar-badge{font-size:0.55rem;padding:0.05rem 0.3rem;border-radius:99px;font-weight:600}
.idea-sidebar-badge.draft{background:var(--bg-tertiary);color:var(--text-secondary)}
.idea-sidebar-badge.analyzed{background:rgba(88,166,255,0.15);color:var(--blue)}
.idea-sidebar-badge.epic_created{background:rgba(63,185,80,0.15);color:var(--green)}
.idea-sidebar-footer{padding:0.4rem 0.6rem;border-top:1px solid var(--border)}
