{
  "_meta": {
    "pattern": "combobox",
    "wcag_source": "https://www.w3.org/WAI/ARIA/apg/patterns/combobox/",
    "version": "1.0.0",
    "updated": "2026-01-06"
  },

  "applies_to": ["select", "dropdown", "autocomplete", "date-picker", "combobox"],

  "variants": {
    "select-only": {
      "description": "Single selection from predefined options",
      "editable": false
    },
    "editable": {
      "description": "Can type to filter/create options",
      "editable": true
    }
  },

  "structure": {
    "combobox": {
      "element": "div",
      "aria": {
        "role": "combobox",
        "aria-expanded": { "type": "boolean", "default": "false" },
        "aria-haspopup": "listbox",
        "aria-controls": { "type": "idref", "points_to": "listbox" },
        "aria-activedescendant": { "type": "idref", "points_to": "focused_option", "when": "open" }
      },
      "attributes": { "tabindex": "0" }
    },
    "input": {
      "element": "input",
      "aria": {
        "aria-autocomplete": { "values": ["none", "list", "both"], "when": "editable" }
      },
      "when": "editable"
    },
    "button": {
      "element": "button",
      "aria": {
        "aria-label": "Ouvrir la liste",
        "tabindex": "-1"
      },
      "class_pattern": "__trigger"
    },
    "listbox": {
      "element": "div",
      "aria": {
        "role": "listbox",
        "aria-labelledby": { "type": "idref", "points_to": "label" }
      },
      "hidden_when": "closed"
    },
    "option": {
      "element": "div",
      "aria": {
        "role": "option",
        "aria-selected": { "type": "boolean" }
      },
      "attributes": { "tabindex": "-1" }
    },
    "group": {
      "element": "div",
      "aria": {
        "role": "group",
        "aria-labelledby": { "type": "idref", "points_to": "group_label" }
      },
      "optional": true
    }
  },

  "states": {
    "closed": {
      "combobox": { "aria-expanded": "false" },
      "listbox": { "hidden": true },
      "data_attr": "data-state=closed"
    },
    "open": {
      "combobox": { "aria-expanded": "true" },
      "listbox": { "hidden": false },
      "data_attr": "data-state=open"
    },
    "disabled": {
      "combobox": { "aria-disabled": "true" },
      "data_attr": "data-state=disabled"
    }
  },

  "keyboard": {
    "when_closed": {
      "Enter": { "action": "open" },
      "Space": { "action": "open" },
      "ArrowDown": { "action": "open_and_focus_first" },
      "ArrowUp": { "action": "open_and_focus_last" },
      "Home": { "action": "open_and_focus_first", "when": "editable" },
      "End": { "action": "open_and_focus_last", "when": "editable" },
      "Printable": { "action": "typeahead_or_open", "when": "not_editable" }
    },
    "when_open": {
      "Enter": { "action": "select_and_close" },
      "Space": { "action": "select_and_close", "when": "not_editable" },
      "Escape": { "action": "close_without_selecting" },
      "Tab": { "action": "select_and_close_and_move_focus" },
      "ArrowDown": { "action": "focus_next_option" },
      "ArrowUp": { "action": "focus_previous_option" },
      "Home": { "action": "focus_first_option" },
      "End": { "action": "focus_last_option" },
      "PageUp": { "action": "focus_option_minus_10" },
      "PageDown": { "action": "focus_option_plus_10" },
      "Printable": { "action": "typeahead" }
    }
  },

  "focus_management": {
    "pattern": "aria-activedescendant",
    "description": "DOM focus stays on combobox, visual focus via aria-activedescendant",
    "on_open": "focus_selected_or_first",
    "on_close": "return_to_combobox",
    "scroll_into_view": true
  },

  "typeahead": {
    "enabled": true,
    "timeout_ms": 500,
    "match": "starts_with",
    "case_sensitive": false
  },

  "animation": {
    "open": { "property": "opacity, transform", "duration": "150ms" },
    "close": { "property": "opacity, transform", "duration": "100ms" }
  },

  "css_selectors": {
    "open": "[aria-expanded='true'], [data-state='open']",
    "closed": "[aria-expanded='false'], [data-state='closed']",
    "selected": "[aria-selected='true']",
    "focused": "[data-focused='true'], .is-focused",
    "disabled": "[aria-disabled='true']"
  }
}
